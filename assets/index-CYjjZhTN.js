(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();var Q={},Et=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Ze={},A={};let Pe;const wt=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];A.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};A.getSymbolTotalCodewords=function(e){return wt[e]};A.getBCHDigit=function(e){let t=0;for(;e!==0;)t++,e>>>=1;return t};A.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Pe=e};A.isKanjiModeEnabled=function(){return typeof Pe<"u"};A.toSJIS=function(e){return Pe(e)};var me={};(function(e){e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function t(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+n)}}e.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},e.from=function(n,o){if(e.isValid(n))return n;try{return t(n)}catch{return o}}})(me);function Xe(){this.buffer=[],this.length=0}Xe.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let n=0;n<t;n++)this.putBit((e>>>t-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var bt=Xe;function oe(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}oe.prototype.set=function(e,t,n,o){const r=e*this.size+t;this.data[r]=n,o&&(this.reservedBit[r]=!0)};oe.prototype.get=function(e,t){return this.data[e*this.size+t]};oe.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n};oe.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]};var kt=oe,et={};(function(e){const t=A.getSymbolSize;e.getRowColCoords=function(n){if(n===1)return[];const o=Math.floor(n/7)+2,r=t(n),a=r===145?26:Math.ceil((r-13)/(2*o-2))*2,i=[r-7];for(let s=1;s<o-1;s++)i[s]=i[s-1]-a;return i.push(6),i.reverse()},e.getPositions=function(n){const o=[],r=e.getRowColCoords(n),a=r.length;for(let i=0;i<a;i++)for(let s=0;s<a;s++)i===0&&s===0||i===0&&s===a-1||i===a-1&&s===0||o.push([r[i],r[s]]);return o}})(et);var tt={};const It=A.getSymbolSize,ze=7;tt.getPositions=function(e){const t=It(e);return[[0,0],[t-ze,0],[0,t-ze]]};var nt={};(function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};e.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},e.from=function(o){return e.isValid(o)?parseInt(o,10):void 0},e.getPenaltyN1=function(o){const r=o.size;let a=0,i=0,s=0,c=null,l=null;for(let d=0;d<r;d++){i=s=0,c=l=null;for(let w=0;w<r;w++){let u=o.get(d,w);u===c?i++:(i>=5&&(a+=t.N1+(i-5)),c=u,i=1),u=o.get(w,d),u===l?s++:(s>=5&&(a+=t.N1+(s-5)),l=u,s=1)}i>=5&&(a+=t.N1+(i-5)),s>=5&&(a+=t.N1+(s-5))}return a},e.getPenaltyN2=function(o){const r=o.size;let a=0;for(let i=0;i<r-1;i++)for(let s=0;s<r-1;s++){const c=o.get(i,s)+o.get(i,s+1)+o.get(i+1,s)+o.get(i+1,s+1);(c===4||c===0)&&a++}return a*t.N2},e.getPenaltyN3=function(o){const r=o.size;let a=0,i=0,s=0;for(let c=0;c<r;c++){i=s=0;for(let l=0;l<r;l++)i=i<<1&2047|o.get(c,l),l>=10&&(i===1488||i===93)&&a++,s=s<<1&2047|o.get(l,c),l>=10&&(s===1488||s===93)&&a++}return a*t.N3},e.getPenaltyN4=function(o){let r=0;const a=o.data.length;for(let i=0;i<a;i++)r+=o.data[i];return Math.abs(Math.ceil(r*100/a/5)-10)*t.N4};function n(o,r,a){switch(o){case e.Patterns.PATTERN000:return(r+a)%2===0;case e.Patterns.PATTERN001:return r%2===0;case e.Patterns.PATTERN010:return a%3===0;case e.Patterns.PATTERN011:return(r+a)%3===0;case e.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(a/3))%2===0;case e.Patterns.PATTERN101:return r*a%2+r*a%3===0;case e.Patterns.PATTERN110:return(r*a%2+r*a%3)%2===0;case e.Patterns.PATTERN111:return(r*a%3+(r+a)%2)%2===0;default:throw new Error("bad maskPattern:"+o)}}e.applyMask=function(o,r){const a=r.size;for(let i=0;i<a;i++)for(let s=0;s<a;s++)r.isReserved(s,i)||r.xor(s,i,n(o,s,i))},e.getBestMask=function(o,r){const a=Object.keys(e.Patterns).length;let i=0,s=1/0;for(let c=0;c<a;c++){r(c),e.applyMask(c,o);const l=e.getPenaltyN1(o)+e.getPenaltyN2(o)+e.getPenaltyN3(o)+e.getPenaltyN4(o);e.applyMask(c,o),l<s&&(s=l,i=c)}return i}})(nt);var pe={};const U=me,ae=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],ie=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];pe.getBlocksCount=function(e,t){switch(t){case U.L:return ae[(e-1)*4+0];case U.M:return ae[(e-1)*4+1];case U.Q:return ae[(e-1)*4+2];case U.H:return ae[(e-1)*4+3];default:return}};pe.getTotalCodewordsCount=function(e,t){switch(t){case U.L:return ie[(e-1)*4+0];case U.M:return ie[(e-1)*4+1];case U.Q:return ie[(e-1)*4+2];case U.H:return ie[(e-1)*4+3];default:return}};var ot={},ge={};const X=new Uint8Array(512),ce=new Uint8Array(256);(function(){let e=1;for(let t=0;t<255;t++)X[t]=e,ce[e]=t,e<<=1,e&256&&(e^=285);for(let t=255;t<512;t++)X[t]=X[t-255]})();ge.log=function(e){if(e<1)throw new Error("log("+e+")");return ce[e]};ge.exp=function(e){return X[e]};ge.mul=function(e,t){return e===0||t===0?0:X[ce[e]+ce[t]]};(function(e){const t=ge;e.mul=function(n,o){const r=new Uint8Array(n.length+o.length-1);for(let a=0;a<n.length;a++)for(let i=0;i<o.length;i++)r[a+i]^=t.mul(n[a],o[i]);return r},e.mod=function(n,o){let r=new Uint8Array(n);for(;r.length-o.length>=0;){const a=r[0];for(let s=0;s<o.length;s++)r[s]^=t.mul(o[s],a);let i=0;for(;i<r.length&&r[i]===0;)i++;r=r.slice(i)}return r},e.generateECPolynomial=function(n){let o=new Uint8Array([1]);for(let r=0;r<n;r++)o=e.mul(o,new Uint8Array([1,t.exp(r)]));return o}})(ot);const rt=ot;function xe(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}xe.prototype.initialize=function(e){this.degree=e,this.genPoly=rt.generateECPolynomial(this.degree)};xe.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const n=rt.mod(t,this.genPoly),o=this.degree-n.length;if(o>0){const r=new Uint8Array(this.degree);return r.set(n,o),r}return n};var Bt=xe,at={},H={},Se={};Se.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var R={};const it="[0-9]+",Lt="[A-Z $%*+\\-./:]+";let te="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";te=te.replace(/u/g,"\\u");const Ct="(?:(?![A-Z0-9 $%*+\\-./:]|"+te+`)(?:.|[\r
]))+`;R.KANJI=new RegExp(te,"g");R.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");R.BYTE=new RegExp(Ct,"g");R.NUMERIC=new RegExp(it,"g");R.ALPHANUMERIC=new RegExp(Lt,"g");const Tt=new RegExp("^"+te+"$"),At=new RegExp("^"+it+"$"),Mt=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");R.testKanji=function(e){return Tt.test(e)};R.testNumeric=function(e){return At.test(e)};R.testAlphanumeric=function(e){return Mt.test(e)};(function(e){const t=Se,n=R;e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(r,a){if(!r.ccBits)throw new Error("Invalid mode: "+r);if(!t.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?r.ccBits[0]:a<27?r.ccBits[1]:r.ccBits[2]},e.getBestModeForData=function(r){return n.testNumeric(r)?e.NUMERIC:n.testAlphanumeric(r)?e.ALPHANUMERIC:n.testKanji(r)?e.KANJI:e.BYTE},e.toString=function(r){if(r&&r.id)return r.id;throw new Error("Invalid mode")},e.isValid=function(r){return r&&r.bit&&r.ccBits};function o(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+r)}}e.from=function(r,a){if(e.isValid(r))return r;try{return o(r)}catch{return a}}})(H);(function(e){const t=A,n=pe,o=me,r=H,a=Se,i=7973,s=t.getBCHDigit(i);function c(u,y,g){for(let b=1;b<=40;b++)if(y<=e.getCapacity(b,g,u))return b}function l(u,y){return r.getCharCountIndicator(u,y)+4}function d(u,y){let g=0;return u.forEach(function(b){const L=l(b.mode,y);g+=L+b.getBitsLength()}),g}function w(u,y){for(let g=1;g<=40;g++)if(d(u,g)<=e.getCapacity(g,y,r.MIXED))return g}e.from=function(u,y){return a.isValid(u)?parseInt(u,10):y},e.getCapacity=function(u,y,g){if(!a.isValid(u))throw new Error("Invalid QR Code version");typeof g>"u"&&(g=r.BYTE);const b=t.getSymbolTotalCodewords(u),L=n.getTotalCodewordsCount(u,y),f=(b-L)*8;if(g===r.MIXED)return f;const h=f-l(g,u);switch(g){case r.NUMERIC:return Math.floor(h/10*3);case r.ALPHANUMERIC:return Math.floor(h/11*2);case r.KANJI:return Math.floor(h/13);case r.BYTE:default:return Math.floor(h/8)}},e.getBestVersionForData=function(u,y){let g;const b=o.from(y,o.M);if(Array.isArray(u)){if(u.length>1)return w(u,b);if(u.length===0)return 1;g=u[0]}else g=u;return c(g.mode,g.getLength(),b)},e.getEncodedBits=function(u){if(!a.isValid(u)||u<7)throw new Error("Invalid QR Code version");let y=u<<12;for(;t.getBCHDigit(y)-s>=0;)y^=i<<t.getBCHDigit(y)-s;return u<<12|y}})(at);var st={};const Ce=A,ct=1335,$t=21522,_e=Ce.getBCHDigit(ct);st.getEncodedBits=function(e,t){const n=e.bit<<3|t;let o=n<<10;for(;Ce.getBCHDigit(o)-_e>=0;)o^=ct<<Ce.getBCHDigit(o)-_e;return(n<<10|o)^$t};var lt={};const Nt=H;function V(e){this.mode=Nt.NUMERIC,this.data=e.toString()}V.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};V.prototype.getLength=function(){return this.data.length};V.prototype.getBitsLength=function(){return V.getBitsLength(this.data.length)};V.prototype.write=function(e){let t,n,o;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),o=parseInt(n,10),e.put(o,10);const r=this.data.length-t;r>0&&(n=this.data.substr(t),o=parseInt(n,10),e.put(o,r*3+1))};var Rt=V;const Pt=H,ve=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function z(e){this.mode=Pt.ALPHANUMERIC,this.data=e}z.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};z.prototype.getLength=function(){return this.data.length};z.prototype.getBitsLength=function(){return z.getBitsLength(this.data.length)};z.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=ve.indexOf(this.data[t])*45;n+=ve.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(ve.indexOf(this.data[t]),6)};var xt=z;const St=H;function _(e){this.mode=St.BYTE,typeof e=="string"?this.data=new TextEncoder().encode(e):this.data=new Uint8Array(e)}_.getBitsLength=function(e){return e*8};_.prototype.getLength=function(){return this.data.length};_.prototype.getBitsLength=function(){return _.getBitsLength(this.data.length)};_.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)};var Ut=_;const Ht=H,Dt=A;function J(e){this.mode=Ht.KANJI,this.data=e}J.getBitsLength=function(e){return e*13};J.prototype.getLength=function(){return this.data.length};J.prototype.getBitsLength=function(){return J.getBitsLength(this.data.length)};J.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=Dt.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),e.put(n,13)}};var Kt=J,dt={exports:{}};(function(e){var t={single_source_shortest_paths:function(n,o,r){var a={},i={};i[o]=0;var s=t.PriorityQueue.make();s.push(o,0);for(var c,l,d,w,u,y,g,b,L;!s.empty();){c=s.pop(),l=c.value,w=c.cost,u=n[l]||{};for(d in u)u.hasOwnProperty(d)&&(y=u[d],g=w+y,b=i[d],L=typeof i[d]>"u",(L||b>g)&&(i[d]=g,s.push(d,g),a[d]=l))}if(typeof r<"u"&&typeof i[r]>"u"){var f=["Could not find a path from ",o," to ",r,"."].join("");throw new Error(f)}return a},extract_shortest_path_from_predecessor_list:function(n,o){for(var r=[],a=o;a;)r.push(a),n[a],a=n[a];return r.reverse(),r},find_path:function(n,o,r){var a=t.single_source_shortest_paths(n,o,r);return t.extract_shortest_path_from_predecessor_list(a,r)},PriorityQueue:{make:function(n){var o=t.PriorityQueue,r={},a;n=n||{};for(a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);return r.queue=[],r.sorter=n.sorter||o.default_sorter,r},default_sorter:function(n,o){return n.cost-o.cost},push:function(n,o){var r={value:n,cost:o};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};e.exports=t})(dt);var Ot=dt.exports;(function(e){const t=H,n=Rt,o=xt,r=Ut,a=Kt,i=R,s=A,c=Ot;function l(f){return unescape(encodeURIComponent(f)).length}function d(f,h,m){const p=[];let v;for(;(v=f.exec(m))!==null;)p.push({data:v[0],index:v.index,mode:h,length:v[0].length});return p}function w(f){const h=d(i.NUMERIC,t.NUMERIC,f),m=d(i.ALPHANUMERIC,t.ALPHANUMERIC,f);let p,v;return s.isKanjiModeEnabled()?(p=d(i.BYTE,t.BYTE,f),v=d(i.KANJI,t.KANJI,f)):(p=d(i.BYTE_KANJI,t.BYTE,f),v=[]),h.concat(m,p,v).sort(function(E,C){return E.index-C.index}).map(function(E){return{data:E.data,mode:E.mode,length:E.length}})}function u(f,h){switch(h){case t.NUMERIC:return n.getBitsLength(f);case t.ALPHANUMERIC:return o.getBitsLength(f);case t.KANJI:return a.getBitsLength(f);case t.BYTE:return r.getBitsLength(f)}}function y(f){return f.reduce(function(h,m){const p=h.length-1>=0?h[h.length-1]:null;return p&&p.mode===m.mode?(h[h.length-1].data+=m.data,h):(h.push(m),h)},[])}function g(f){const h=[];for(let m=0;m<f.length;m++){const p=f[m];switch(p.mode){case t.NUMERIC:h.push([p,{data:p.data,mode:t.ALPHANUMERIC,length:p.length},{data:p.data,mode:t.BYTE,length:p.length}]);break;case t.ALPHANUMERIC:h.push([p,{data:p.data,mode:t.BYTE,length:p.length}]);break;case t.KANJI:h.push([p,{data:p.data,mode:t.BYTE,length:l(p.data)}]);break;case t.BYTE:h.push([{data:p.data,mode:t.BYTE,length:l(p.data)}])}}return h}function b(f,h){const m={},p={start:{}};let v=["start"];for(let E=0;E<f.length;E++){const C=f[E],$=[];for(let re=0;re<C.length;re++){const N=C[re],Z=""+E+re;$.push(Z),m[Z]={node:N,lastCount:0},p[Z]={};for(let ye=0;ye<v.length;ye++){const P=v[ye];m[P]&&m[P].node.mode===N.mode?(p[P][Z]=u(m[P].lastCount+N.length,N.mode)-u(m[P].lastCount,N.mode),m[P].lastCount+=N.length):(m[P]&&(m[P].lastCount=N.length),p[P][Z]=u(N.length,N.mode)+4+t.getCharCountIndicator(N.mode,h))}}v=$}for(let E=0;E<v.length;E++)p[v[E]].end=0;return{map:p,table:m}}function L(f,h){let m;const p=t.getBestModeForData(f);if(m=t.from(h,p),m!==t.BYTE&&m.bit<p.bit)throw new Error('"'+f+'" cannot be encoded with mode '+t.toString(m)+`.
 Suggested mode is: `+t.toString(p));switch(m===t.KANJI&&!s.isKanjiModeEnabled()&&(m=t.BYTE),m){case t.NUMERIC:return new n(f);case t.ALPHANUMERIC:return new o(f);case t.KANJI:return new a(f);case t.BYTE:return new r(f)}}e.fromArray=function(f){return f.reduce(function(h,m){return typeof m=="string"?h.push(L(m,null)):m.data&&h.push(L(m.data,m.mode)),h},[])},e.fromString=function(f,h){const m=w(f,s.isKanjiModeEnabled()),p=g(m),v=b(p,h),E=c.find_path(v.map,"start","end"),C=[];for(let $=1;$<E.length-1;$++)C.push(v.table[E[$]].node);return e.fromArray(y(C))},e.rawSplit=function(f){return e.fromArray(w(f,s.isKanjiModeEnabled()))}})(lt);const he=A,Ee=me,jt=bt,Ft=kt,qt=et,Vt=tt,Te=nt,Ae=pe,zt=Bt,le=at,_t=st,Jt=H,we=lt;function Yt(e,t){const n=e.size,o=Vt.getPositions(t);for(let r=0;r<o.length;r++){const a=o[r][0],i=o[r][1];for(let s=-1;s<=7;s++)if(!(a+s<=-1||n<=a+s))for(let c=-1;c<=7;c++)i+c<=-1||n<=i+c||(s>=0&&s<=6&&(c===0||c===6)||c>=0&&c<=6&&(s===0||s===6)||s>=2&&s<=4&&c>=2&&c<=4?e.set(a+s,i+c,!0,!0):e.set(a+s,i+c,!1,!0))}}function Qt(e){const t=e.size;for(let n=8;n<t-8;n++){const o=n%2===0;e.set(n,6,o,!0),e.set(6,n,o,!0)}}function Wt(e,t){const n=qt.getPositions(t);for(let o=0;o<n.length;o++){const r=n[o][0],a=n[o][1];for(let i=-2;i<=2;i++)for(let s=-2;s<=2;s++)i===-2||i===2||s===-2||s===2||i===0&&s===0?e.set(r+i,a+s,!0,!0):e.set(r+i,a+s,!1,!0)}}function Gt(e,t){const n=e.size,o=le.getEncodedBits(t);let r,a,i;for(let s=0;s<18;s++)r=Math.floor(s/3),a=s%3+n-8-3,i=(o>>s&1)===1,e.set(r,a,i,!0),e.set(a,r,i,!0)}function be(e,t,n){const o=e.size,r=_t.getEncodedBits(t,n);let a,i;for(a=0;a<15;a++)i=(r>>a&1)===1,a<6?e.set(a,8,i,!0):a<8?e.set(a+1,8,i,!0):e.set(o-15+a,8,i,!0),a<8?e.set(8,o-a-1,i,!0):a<9?e.set(8,15-a-1+1,i,!0):e.set(8,15-a-1,i,!0);e.set(o-8,8,1,!0)}function Zt(e,t){const n=e.size;let o=-1,r=n-1,a=7,i=0;for(let s=n-1;s>0;s-=2)for(s===6&&s--;;){for(let c=0;c<2;c++)if(!e.isReserved(r,s-c)){let l=!1;i<t.length&&(l=(t[i]>>>a&1)===1),e.set(r,s-c,l),a--,a===-1&&(i++,a=7)}if(r+=o,r<0||n<=r){r-=o,o=-o;break}}}function Xt(e,t,n){const o=new jt;n.forEach(function(c){o.put(c.mode.bit,4),o.put(c.getLength(),Jt.getCharCountIndicator(c.mode,e)),c.write(o)});const r=he.getSymbolTotalCodewords(e),a=Ae.getTotalCodewordsCount(e,t),i=(r-a)*8;for(o.getLengthInBits()+4<=i&&o.put(0,4);o.getLengthInBits()%8!==0;)o.putBit(0);const s=(i-o.getLengthInBits())/8;for(let c=0;c<s;c++)o.put(c%2?17:236,8);return en(o,e,t)}function en(e,t,n){const o=he.getSymbolTotalCodewords(t),r=Ae.getTotalCodewordsCount(t,n),a=o-r,i=Ae.getBlocksCount(t,n),s=o%i,c=i-s,l=Math.floor(o/i),d=Math.floor(a/i),w=d+1,u=l-d,y=new zt(u);let g=0;const b=new Array(i),L=new Array(i);let f=0;const h=new Uint8Array(e.buffer);for(let C=0;C<i;C++){const $=C<c?d:w;b[C]=h.slice(g,g+$),L[C]=y.encode(b[C]),g+=$,f=Math.max(f,$)}const m=new Uint8Array(o);let p=0,v,E;for(v=0;v<f;v++)for(E=0;E<i;E++)v<b[E].length&&(m[p++]=b[E][v]);for(v=0;v<u;v++)for(E=0;E<i;E++)m[p++]=L[E][v];return m}function tn(e,t,n,o){let r;if(Array.isArray(e))r=we.fromArray(e);else if(typeof e=="string"){let l=t;if(!l){const d=we.rawSplit(e);l=le.getBestVersionForData(d,n)}r=we.fromString(e,l||40)}else throw new Error("Invalid data");const a=le.getBestVersionForData(r,n);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=a;else if(t<a)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+a+`.
`);const i=Xt(t,n,r),s=he.getSymbolSize(t),c=new Ft(s);return Yt(c,t),Qt(c),Wt(c,t),be(c,n,0),t>=7&&Gt(c,t),Zt(c,i),isNaN(o)&&(o=Te.getBestMask(c,be.bind(null,c,n))),Te.applyMask(o,c),be(c,n,o),{modules:c,version:t,errorCorrectionLevel:n,maskPattern:o,segments:r}}Ze.create=function(e,t){if(typeof e>"u"||e==="")throw new Error("No input text");let n=Ee.M,o,r;return typeof t<"u"&&(n=Ee.from(t.errorCorrectionLevel,Ee.M),o=le.from(t.version),r=Te.from(t.maskPattern),t.toSJISFunc&&he.setToSJISFunction(t.toSJISFunc)),tn(e,o,n,r)};var ut={},Ue={};(function(e){function t(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let o=n.slice().replace("#","").split("");if(o.length<3||o.length===5||o.length>8)throw new Error("Invalid hex color: "+n);(o.length===3||o.length===4)&&(o=Array.prototype.concat.apply([],o.map(function(a){return[a,a]}))),o.length===6&&o.push("F","F");const r=parseInt(o.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+o.slice(0,6).join("")}}e.getOptions=function(n){n||(n={}),n.color||(n.color={});const o=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,r=n.width&&n.width>=21?n.width:void 0,a=n.scale||4;return{width:r,scale:r?4:a,margin:o,color:{dark:t(n.color.dark||"#000000ff"),light:t(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},e.getScale=function(n,o){return o.width&&o.width>=n+o.margin*2?o.width/(n+o.margin*2):o.scale},e.getImageWidth=function(n,o){const r=e.getScale(n,o);return Math.floor((n+o.margin*2)*r)},e.qrToImageData=function(n,o,r){const a=o.modules.size,i=o.modules.data,s=e.getScale(a,r),c=Math.floor((a+r.margin*2)*s),l=r.margin*s,d=[r.color.light,r.color.dark];for(let w=0;w<c;w++)for(let u=0;u<c;u++){let y=(w*c+u)*4,g=r.color.light;if(w>=l&&u>=l&&w<c-l&&u<c-l){const b=Math.floor((w-l)/s),L=Math.floor((u-l)/s);g=d[i[b*a+L]?1:0]}n[y++]=g.r,n[y++]=g.g,n[y++]=g.b,n[y]=g.a}}})(Ue);(function(e){const t=Ue;function n(r,a,i){r.clearRect(0,0,a.width,a.height),a.style||(a.style={}),a.height=i,a.width=i,a.style.height=i+"px",a.style.width=i+"px"}function o(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}e.render=function(r,a,i){let s=i,c=a;typeof s>"u"&&(!a||!a.getContext)&&(s=a,a=void 0),a||(c=o()),s=t.getOptions(s);const l=t.getImageWidth(r.modules.size,s),d=c.getContext("2d"),w=d.createImageData(l,l);return t.qrToImageData(w.data,r,s),n(d,c,l),d.putImageData(w,0,0),c},e.renderToDataURL=function(r,a,i){let s=i;typeof s>"u"&&(!a||!a.getContext)&&(s=a,a=void 0),s||(s={});const c=e.render(r,a,s),l=s.type||"image/png",d=s.rendererOpts||{};return c.toDataURL(l,d.quality)}})(ut);var ft={};const nn=Ue;function Je(e,t){const n=e.a/255,o=t+'="'+e.hex+'"';return n<1?o+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':o}function ke(e,t,n){let o=e+t;return typeof n<"u"&&(o+=" "+n),o}function on(e,t,n){let o="",r=0,a=!1,i=0;for(let s=0;s<e.length;s++){const c=Math.floor(s%t),l=Math.floor(s/t);!c&&!a&&(a=!0),e[s]?(i++,s>0&&c>0&&e[s-1]||(o+=a?ke("M",c+n,.5+l+n):ke("m",r,0),r=0,a=!1),c+1<t&&e[s+1]||(o+=ke("h",i),i=0)):r++}return o}ft.render=function(e,t,n){const o=nn.getOptions(t),r=e.modules.size,a=e.modules.data,i=r+o.margin*2,s=o.color.light.a?"<path "+Je(o.color.light,"fill")+' d="M0 0h'+i+"v"+i+'H0z"/>':"",c="<path "+Je(o.color.dark,"stroke")+' d="'+on(a,r,o.margin)+'"/>',l='viewBox="0 0 '+i+" "+i+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+l+' shape-rendering="crispEdges">'+s+c+`</svg>
`;return typeof n=="function"&&n(null,d),d};const rn=Et,Me=Ze,mt=ut,an=ft;function He(e,t,n,o,r){const a=[].slice.call(arguments,1),i=a.length,s=typeof a[i-1]=="function";if(!s&&!rn())throw new Error("Callback required as last argument");if(s){if(i<2)throw new Error("Too few arguments provided");i===2?(r=n,n=t,t=o=void 0):i===3&&(t.getContext&&typeof r>"u"?(r=o,o=void 0):(r=o,o=n,n=t,t=void 0))}else{if(i<1)throw new Error("Too few arguments provided");return i===1?(n=t,t=o=void 0):i===2&&!t.getContext&&(o=n,n=t,t=void 0),new Promise(function(c,l){try{const d=Me.create(n,o);c(e(d,t,o))}catch(d){l(d)}})}try{const c=Me.create(n,o);r(null,e(c,t,o))}catch(c){r(c)}}Q.create=Me.create;Q.toCanvas=He.bind(null,mt.render);Q.toDataURL=He.bind(null,mt.renderToDataURL);Q.toString=He.bind(null,function(e,t,n){return an.render(e,n)});let I=null,k=new Map,x=[],B=null;const j=document.getElementById("preference-category"),$e=document.getElementById("preference-search"),Ye=document.getElementById("clear-preferences"),se=document.getElementById("preferences-list"),Qe=document.getElementById("selected-preferences"),We=document.getElementById("selected-list"),sn=document.getElementById("preference-count"),Ne=document.querySelectorAll(".template-btn"),D=document.getElementById("preferences-qr"),de=document.getElementById("preferences-download"),ue=document.getElementById("preferences-copy"),fe=document.getElementById("preferences-package"),S=document.getElementById("atak-version"),Re=document.getElementById("hide-disable-toggle"),cn=document.getElementById("hide-disable-container");async function ln(){console.log("Initializing preferences..."),await un(),await fn(),pn(),gn(),I&&I.preferenceKeys?(x=Object.entries(I.preferenceKeys),console.log(`Initialized ${x.length} preferences`),console.log("Sample preferences:",x.slice(0,3))):(console.error("No preference data available"),console.error("preferenceData structure:",I),x=[]),O(),console.log("Preferences initialization complete")}function dn(){console.log("Refreshing preferences display..."),O()}async function un(){try{console.log("Loading preference data...");const e=await fetch("/docs/reference/ATAK-Preference-Keys-Data.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);I=await e.json(),console.log("Loaded preference data:",I.metadata),console.log(`Total preference keys: ${Object.keys(I.preferenceKeys).length}`)}catch(e){console.error("Failed to load preference data:",e),I={metadata:{totalKeys:0},preferenceKeys:{locationCallsign:{name:"My Callsign",type:"string",category:"identity",description:"User's callsign identifier",defaultValue:"",allowedValues:["alphanumeric"]},locationTeam:{name:"My Team",type:"string",category:"identity",description:"Team color affiliation",defaultValue:"White",allowedValues:["White","Yellow","Orange","Magenta","Red","Maroon","Purple","Dark Blue","Blue","Cyan","Teal","Green","Dark Green","Brown"]},atakRoleType:{name:"My Role",type:"string",category:"identity",description:"User's operational role",defaultValue:"Team Member",allowedValues:["Team Member","Team Lead","HQ","Sniper","Medic","Forward Observer","RTO","K9"]}}},console.log("Using fallback preference data")}}async function fn(){try{const e=[{version:"5.4.0",file:"5.4.0-prefs.txt"},{version:"5.2.0.0",file:"5.2.0.0-prefs.txt"},{version:"5.0",file:"5.0-preferences.txt"},{version:"4.8.1",file:"4.8.1-preferences.txt"}];B={};for(const{version:o,file:r}of e)try{const a=await(await fetch(`/docs/versions/${r}`)).text();B[o]=mn(a),console.log(`Loaded version ${o} data:`,{hideCount:B[o].hide.size,disableCount:B[o].disable.size,sampleKeys:Array.from(B[o].hide.keys()).slice(0,5)})}catch(a){console.warn(`Failed to load version ${o} data:`,a)}console.log("Loaded version data:",Object.keys(B));const t="locationCallsign";for(const[o,r]of Object.entries(B)){const a=r.hide.has(t)||r.disable.has(t);console.log(`Version ${o} has ${t}:`,a),a&&console.log(`  Name: ${r.hide.get(t)||r.disable.get(t)}`)}console.log("Testing version filtering logic...");const n=Object.keys(I.preferenceKeys).slice(0,5);for(const o of Object.keys(B)){console.log(`
Version ${o}:`);for(const r of n){const a=B[o],i=a.hide.has(r),s=a.disable.has(r);console.log(`  ${r}: hide=${i}, disable=${s}`)}}}catch(e){console.error("Failed to load version data:",e),B={}}}function mn(e){const t={hide:new Map,disable:new Map},n=e.split(`
`);for(const o of n){const r=o.match(/'([^']+)',\s*'([^']+)'/);if(r){const[,a,i]=r,s=/^[a-zA-Z][a-zA-Z0-9_]*$/.test(a)&&!a.includes(" "),c=/^[a-zA-Z][a-zA-Z0-9_]*$/.test(i)&&!i.includes(" ");let l,d;s&&!c?(l=a,d=i):!s&&c?(l=i,d=a):(l=a,d=i),t.hide.set(l,d),t.disable.set(l,d)}}return t}function pn(){console.log("Setting up event listeners..."),j?(j.addEventListener("change",Ie),console.log("Category select listener added")):console.warn("Category select element not found"),$e?($e.addEventListener("input",Ie),console.log("Search input listener added")):console.warn("Search input element not found"),Ye?(Ye.addEventListener("click",In),console.log("Clear button listener added")):console.warn("Clear button element not found"),Ne.forEach(e=>{e.addEventListener("click",()=>Bn(e.dataset.template))}),console.log(`Template button listeners added: ${Ne.length}`),de&&(de.addEventListener("click",()=>Ln()),console.log("Download button listener added")),ue&&(ue.addEventListener("click",()=>Cn()),console.log("Copy button listener added")),fe&&(fe.addEventListener("click",Tn),console.log("Package button listener added")),S?(S.addEventListener("change",Ie),console.log("Version select listener added")):console.warn("Version select element not found"),Re?(Re.addEventListener("change",hn),console.log("Hide/disable toggle listener added")):console.warn("Hide/disable toggle element not found"),console.log("Event listeners setup complete")}function gn(){if(!S)return;const e=Object.keys(B).sort((t,n)=>{const o=t.split(".").map(Number),r=n.split(".").map(Number);for(let a=0;a<Math.max(o.length,r.length);a++){const i=o[a]||0,s=r[a]||0;if(i!==s)return s-i}return 0});S.innerHTML='<option value="">All Versions</option>',e.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=`ATAK ${t}`,S.appendChild(n)}),j&&I&&I.metadata&&I.metadata.categories?(j.innerHTML='<option value="">All Categories</option>',I.metadata.categories.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t.charAt(0).toUpperCase()+t.slice(1),j.appendChild(n)}),console.log(`Populated category select with ${I.metadata.categories.length} categories`)):console.warn("Could not populate category select - missing data")}function hn(){const e=Re.checked,t=cn;e?(t.style.display="block",t.innerHTML=`
            <div class="hide-disable-controls">
                <div class="control-group">
                    <label>Action Type:</label>
                    <select id="action-type" class="form-select">
                        <option value="hide">Hide Preferences</option>
                        <option value="disable">Disable Preferences</option>
                        <option value="both">Both Hide & Disable</option>
                    </select>
                </div>
                <div class="control-group">
                    <button id="apply-hide-disable" class="btn btn-warning">Apply to Selected</button>
                </div>
            </div>
            <div class="hide-disable-info">
                <p><strong>Hide:</strong> Preferences are completely hidden from the user interface</p>
                <p><strong>Disable:</strong> Preferences are visible but grayed out and non-interactive</p>
            </div>
        `,setTimeout(()=>{const n=document.getElementById("apply-hide-disable");n&&n.addEventListener("click",yn)},100)):t.style.display="none"}function yn(){const e=document.getElementById("action-type").value,t=Array.from(k.keys());if(t.length===0){ne("No preferences selected","warning");return}t.forEach(n=>{I.preferenceKeys[n]&&((e==="hide"||e==="both")&&k.set(`hidePreferenceItem_${n}`,!0),(e==="disable"||e==="both")&&k.set(`disablePreferenceItem_${n}`,!0))}),W(),G(),ne(`Applied ${e} to ${t.length} preferences`,"success")}function Ie(){const e=j.value,t=$e.value.toLowerCase(),n=S?S.value:"";x=Object.entries(I.preferenceKeys).filter(([o,r])=>{const a=!e||r.category===e,i=!t||o.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||r.description.toLowerCase().includes(t);let s=!0;if(n&&B[n]){const c=B[n],l=c.hide.has(o),d=c.disable.has(o);s=l||d,n&&console.log(`Version ${n} - ${o}: hide=${l}, disable=${d}, matches=${s}`)}return a&&i&&s}).sort(([,o],[,r])=>o.name.localeCompare(r.name)),O()}function O(){if(console.log("Rendering preferences...",x.length),!se){console.error("Preferences list element not found");return}if(se.innerHTML="",x.length===0){se.innerHTML='<div class="no-results">No preferences found matching your criteria.</div>',console.log("No preferences to render");return}const e=S?S.value:"";console.log(`Rendering ${x.length} preferences for version: ${e||"all"}`),x.forEach(([t,n])=>{const o=vn(t,n,e);se.appendChild(o)}),console.log("Preferences rendering complete")}function vn(e,t,n){const o=document.createElement("div");o.className="preference-item",k.has(e)&&o.classList.add("selected");const r=k.has(e)?k.get(e):t.defaultValue;let a="";if(n&&B[n]){const s=B[n],c=s.hide.has(e),l=s.disable.has(e);(c||l)&&(a=`
                <div class="version-info">
                    <span class="version-badge">ATAK ${n}</span>
                    ${c?'<span class="hide-badge">Hide</span>':""}
                    ${l?'<span class="disable-badge">Disable</span>':""}
                </div>
            `)}o.innerHTML=`
        <div class="preference-header">
            <div class="preference-name">${t.name}</div>
            <div class="preference-category">${t.category}</div>
            ${a}
        </div>
        <div class="preference-description">${t.description}</div>
        <div class="preference-control">
            <label>Value:</label>
            ${En(e,t,r)}
        </div>
        <div class="preference-validation" id="validation-${e}"></div>
    `,o.addEventListener("click",s=>{s.target.matches("input, select")||wn(e,t)});const i=o.querySelector("input, select");return i&&(i.addEventListener("change",s=>{bn(e,s.target.value)}),i.addEventListener("input",s=>{kn(e,t,s.target.value)})),o}function En(e,t,n){switch(t.type){case"boolean":return`
                <select>
                    <option value="true" ${n===!0||n==="true"?"selected":""}>true</option>
                    <option value="false" ${n===!1||n==="false"?"selected":""}>false</option>
                </select>
            `;case"string":return t.allowedValues&&Array.isArray(t.allowedValues)?`
                    <select>
                        ${t.allowedValues.map(o=>`<option value="${o}" ${n===o?"selected":""}>${o}</option>`).join("")}
                    </select>
                `:`<input type="text" value="${n||""}" placeholder="Enter value">`;case"int":case"long":return`<input type="number" value="${n||""}" placeholder="Enter number">`;default:return`<input type="text" value="${n||""}" placeholder="Enter value">`}}function wn(e,t){k.has(e)?k.delete(e):k.set(e,t.defaultValue),O(),W(),G()}function bn(e,t){k.has(e)&&(k.set(e,t),W(),G())}function kn(e,t,n){const o=document.getElementById(`validation-${e}`);if(!o)return;let r=!0,a="";switch(t.type){case"boolean":r=n==="true"||n==="false";break;case"int":case"long":r=!isNaN(n)&&Number.isInteger(Number(n)),r&&t.validation&&(t.validation.minValue!==void 0&&Number(n)<t.validation.minValue&&(r=!1,a=`Minimum value: ${t.validation.minValue}`),t.validation.maxValue!==void 0&&Number(n)>t.validation.maxValue&&(r=!1,a=`Maximum value: ${t.validation.maxValue}`));break;case"string":t.validation&&(t.validation.minLength!==void 0&&n.length<t.validation.minLength&&(r=!1,a=`Minimum length: ${t.validation.minLength}`),t.validation.maxLength!==void 0&&n.length>t.validation.maxLength&&(r=!1,a=`Maximum length: ${t.validation.maxLength}`),t.validation.pattern&&!new RegExp(t.validation.pattern).test(n)&&(r=!1,a="Invalid format"));break}o.className=`preference-validation ${r?"":"error"}`,o.textContent=a}function W(){if(k.size===0){Qe.style.display="none";return}Qe.style.display="block",sn.textContent=k.size,We.innerHTML="",k.forEach((e,t)=>{const n=I.preferenceKeys[t];if(!n)return;const o=document.createElement("div");o.className="selected-item",o.innerHTML=`
            <div class="selected-item-info">
                <div class="selected-item-name">${n.name}</div>
                <div class="selected-item-value">${t} = ${e}</div>
            </div>
            <button class="selected-item-remove" onclick="removePreference('${t}')">Remove</button>
        `,We.appendChild(o)})}window.removePreference=function(e){k.delete(e),O(),W(),G()};function In(){k.clear(),O(),W(),G()}function Bn(e){k.clear();const t={fire:{locationTeam:"Red",atakRoleType:"Team Lead",coord_display_pref:"UTM",largeTextMode:!0,dispatchLocationCotExternal:!0},police:{locationTeam:"Blue",atakRoleType:"Team Member",mockingOption:"WRGPS",locationReportingStrategy:"Dynamic",dispatchLocationCotExternal:!0},ems:{locationTeam:"Green",atakRoleType:"Medic",saHasPhoneNumber:!0,enableToast:!0,vibratePhone:!0,audibleNotify:!0},military:{locationTeam:"Dark Green",atakRoleType:"Team Lead",coord_display_pref:"MGRS",alt_display_pref:"HAE",useGPSTime:!0,dispatchLocationCotExternal:!0},sar:{locationTeam:"Orange",atakRoleType:"Team Member",coord_display_pref:"UTM",alt_unit_pref:"1",enableNonStreamingConnections:!0,dispatchLocationCotExternal:!0}}[e];t&&Object.entries(t).forEach(([n,o])=>{I.preferenceKeys[n]&&k.set(n,o)}),Ne.forEach(n=>n.classList.remove("active")),event.target.classList.add("active"),O(),W(),G()}async function G(){if(k.size===0){D.innerHTML='<div class="qr-placeholder">Select preferences above to generate QR code</div>',de.disabled=!0,ue.disabled=!0,fe.disabled=!0;return}const e=[];let t=1;k.forEach((o,r)=>{const a=I.preferenceKeys[r];a&&(e.push(`key${t}=${encodeURIComponent(r)}`),e.push(`type${t}=${encodeURIComponent(a.type)}`),e.push(`value${t}=${encodeURIComponent(o)}`),t++)});const n=`tak://com.atakmap.app/preference?${e.join("&")}`;try{const o=await Q.toCanvas(n,{width:256,margin:2,color:{dark:"#1e40af",light:"#ffffff"}});D.innerHTML="",D.appendChild(o),de.disabled=!1,ue.disabled=!1,fe.disabled=!1,D.dataset.url=n}catch(o){console.error("Failed to generate QR code:",o),D.innerHTML='<div class="qr-placeholder">Error generating QR code</div>'}}async function Ln(e){const t=D.querySelector("canvas");if(!t)return;const n=document.createElement("a");n.download="atak-preferences.png",n.href=t.toDataURL(),n.click()}function Cn(e){const t=D.dataset.url;t&&navigator.clipboard.writeText(t).then(()=>{ne("Preference URI copied to clipboard","success")}).catch(()=>{ne("Failed to copy URI","error")})}function Tn(){if(k.size===0)return;const e=An(),t=new Blob([e],{type:"application/xml"}),n=document.createElement("a");n.download="atak-config.pref",n.href=URL.createObjectURL(t),n.click(),ne("Data package config.pref downloaded","success")}function An(){const e=[];return k.forEach((t,n)=>{const o=I.preferenceKeys[n];if(o){const r=Mn(o.type);e.push(`    <entry key="${n}" class="${r}">${t}</entry>`)}}),`<?xml version='1.0' encoding='ASCII' standalone='yes'?>
<preferences>
  <preference version="1" name="com.atakmap.app_preferences">
${e.join(`
`)}
  </preference>
</preferences>`}function Mn(e){switch(e){case"boolean":return"class java.lang.Boolean";case"int":return"class java.lang.Integer";case"long":return"class java.lang.Long";case"string":default:return"class java.lang.String"}}function ne(e,t="info"){console.log(`${t.toUpperCase()}: ${e}`)}let ee="atak",M=JSON.parse(localStorage.getItem("tak-profiles")||"[]");const pt=document.querySelectorAll(".tab-btn"),$n=document.querySelectorAll(".tab-pane"),F=document.getElementById("profile-modal"),Nn=document.querySelector(".modal-close"),Rn=document.getElementById("modal-cancel"),Pn=document.getElementById("modal-save"),De=document.getElementById("profile-name"),Ke=document.getElementById("profile-description");document.addEventListener("DOMContentLoaded",async()=>{xn(),Hn(),Dn(),qn(),Ve(),await ln(),Jn(),_n(),zn()});function xn(){pt.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;q(t)})})}function q(e){pt.forEach(t=>t.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),$n.forEach(t=>t.classList.remove("active")),document.getElementById(`${e}-tab`).classList.add("active"),ee==="atak"&&e==="itak"?Sn():ee==="itak"&&e==="atak"&&Un(),e==="preferences"&&dn(),ee=e}function Sn(){const e=document.getElementById("atak-host").value.trim();if(e){const t=document.getElementById("itak-url");t.value.trim()||(t.value=`https://${e}`,je(),vt("itak"),T("Server URL copied from ATAK tab","info"))}}function Un(){const e=document.getElementById("itak-url").value.trim();if(e){let t="";try{const n=e.startsWith("http")?e:`https://${e}`;t=new URL(n).hostname}catch{t=e.replace(/^https?:\/\//,"").split("/")[0].split(":")[0]}if(t){const n=document.getElementById("atak-host");n.value.trim()||(n.value=t,Oe(),vt("atak"),T("Server hostname copied from iTAK tab","info"))}}}function Hn(){document.getElementById("atak-form").querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>Oe())}),document.getElementById("itak-form").querySelectorAll("input, select").forEach(e=>{e.addEventListener("input",()=>je())}),document.getElementById("import-form").querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>gt())}),document.getElementById("atak-download").addEventListener("click",()=>Be("atak")),document.getElementById("atak-copy").addEventListener("click",()=>Le("atak")),document.getElementById("itak-download").addEventListener("click",()=>Be("itak")),document.getElementById("itak-copy").addEventListener("click",()=>Le("itak")),document.getElementById("import-download").addEventListener("click",()=>Be("import")),document.getElementById("import-copy").addEventListener("click",()=>Le("import"))}async function Y(e,t){const n=document.getElementById(t);if(!e)return n.innerHTML='<div class="qr-placeholder">Enter configuration details above</div>',null;try{const o=await Q.toCanvas(e,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});return n.innerHTML="",n.appendChild(o),o}catch(o){return console.error("Error generating QR code:",o),n.innerHTML='<div class="qr-placeholder">Error generating QR code</div>',null}}function Oe(){const e=document.getElementById("atak-host").value.trim(),t=document.getElementById("atak-username").value.trim(),n=document.getElementById("atak-token").value.trim();if(e&&t&&n){const o=`tak://com.atakmap.app/enroll?host=${encodeURIComponent(e)}&username=${encodeURIComponent(t)}&token=${encodeURIComponent(n)}`;Y(o,"atak-qr"),Fe("atak")}else Y(null,"atak-qr"),qe("atak")}function je(){const e=document.getElementById("itak-description").value.trim(),t=document.getElementById("itak-url").value.trim(),n=document.getElementById("itak-port").value.trim(),o=document.getElementById("itak-protocol").value;let r="";try{if(t){const i=t.startsWith("http")?t:`https://${t}`;r=new URL(i).hostname}}catch{r=t.replace(/^https?:\/\//,"").split("/")[0].split(":")[0]}const a=o==="https"?"ssl":"tcp";if([e,r,n].every(i=>i&&i.trim()!=="")){const i=`${e},${r},${n},${a}`;Y(i,"itak-qr"),Fe("itak")}else Y(null,"itak-qr"),qe("itak")}function gt(){const e=document.getElementById("import-url").value.trim();if(e){const t=`tak://com.atakmap.app/import?url=${encodeURIComponent(e)}`;Y(t,"import-qr"),Fe("import")}else Y(null,"import-qr"),qe("import")}function Fe(e){document.getElementById(`${e}-download`).disabled=!1,document.getElementById(`${e}-copy`).disabled=!1}function qe(e){document.getElementById(`${e}-download`).disabled=!0,document.getElementById(`${e}-copy`).disabled=!0}async function Be(e){const t=document.getElementById(`${e}-qr`).querySelector("canvas");if(t)try{const n=document.createElement("a");n.download=`tak-${e}-config.png`,n.href=t.toDataURL(),n.click()}catch(n){console.error("Error downloading QR code:",n),T("Error downloading QR code","error")}}async function Le(e){let t="";switch(e){case"atak":const n=document.getElementById("atak-host").value.trim(),o=document.getElementById("atak-username").value.trim(),r=document.getElementById("atak-token").value.trim();t=`tak://com.atakmap.app/enroll?host=${encodeURIComponent(n)}&username=${encodeURIComponent(o)}&token=${encodeURIComponent(r)}`;break;case"itak":const a=document.getElementById("itak-description").value.trim(),i=document.getElementById("itak-url").value.trim(),s=document.getElementById("itak-port").value.trim(),c=document.getElementById("itak-protocol").value;let l="";try{if(i){const w=i.startsWith("http")?i:`https://${i}`;l=new URL(w).hostname}}catch{l=i.replace(/^https?:\/\//,"").split("/")[0].split(":")[0]}t=`${a},${l},${s},${c==="https"?"ssl":"tcp"}`;break;case"import":const d=document.getElementById("import-url").value.trim();t=`tak://com.atakmap.app/import?url=${encodeURIComponent(d)}`;break}try{await navigator.clipboard.writeText(t),T("URI copied to clipboard!","success")}catch(n){console.error("Error copying to clipboard:",n),T("Error copying to clipboard","error")}}function Dn(){document.getElementById("save-profile").addEventListener("click",()=>{Kn()}),document.getElementById("load-profile").addEventListener("click",()=>{On()})}function Kn(){document.getElementById("modal-title").textContent="Save Profile",F.classList.add("active");const e=ht();e.name&&(De.value=e.name,Ke.value=e.description||"")}function On(){document.getElementById("modal-title").textContent="Load Profile",F.classList.add("active"),Vn()}function ht(){const e={type:ee,timestamp:Date.now()};switch(ee){case"atak":e.host=document.getElementById("atak-host").value,e.username=document.getElementById("atak-username").value,e.token=document.getElementById("atak-token").value;break;case"itak":e.description=document.getElementById("itak-description").value,e.url=document.getElementById("itak-url").value,e.port=document.getElementById("itak-port").value,e.protocol=document.getElementById("itak-protocol").value;break;case"import":e.url=document.getElementById("import-url").value;break}return e}function jn(){const e=De.value.trim(),t=Ke.value.trim();if(!e){T("Profile name is required","error");return}const n=ht();n.name=e,n.description=t;const o=M.findIndex(r=>r.name===e);o>=0?M[o]=n:M.push(n),localStorage.setItem("tak-profiles",JSON.stringify(M)),Ve(),K(),T("Profile saved successfully!","success")}function yt(e){switch(e.type){case"atak":document.getElementById("atak-host").value=e.host||"",document.getElementById("atak-username").value=e.username||"",document.getElementById("atak-token").value=e.token||"",Oe(),q("atak");break;case"itak":document.getElementById("itak-description").value=e.description||"",document.getElementById("itak-url").value=e.url||"",document.getElementById("itak-port").value=e.port||"8089",document.getElementById("itak-protocol").value=e.protocol||"https",je(),q("itak");break;case"import":document.getElementById("import-url").value=e.url||"",gt(),q("import");break}K(),T("Profile loaded successfully!","success")}function Fn(e){confirm(`Are you sure you want to delete the profile "${e}"?`)&&(M=M.filter(t=>t.name!==e),localStorage.setItem("tak-profiles",JSON.stringify(M)),Ve(),T("Profile deleted successfully!","success"))}function Ve(){const e=document.getElementById("profiles-container");if(M.length===0){e.innerHTML='<p style="grid-column: 1 / -1; color: var(--text-secondary);">No saved profiles yet. Create your first profile to get started.</p>';return}e.innerHTML=M.map(t=>`
        <div class="profile-card">
            <h4>${t.name}</h4>
            <p>${t.description||"No description"}</p>
            <p><strong>Type:</strong> ${t.type.toUpperCase()}</p>
            <p><strong>Created:</strong> ${new Date(t.timestamp).toLocaleDateString()}</p>
            <div class="profile-actions">
                <button class="btn btn-primary" onclick="loadProfile(${JSON.stringify(t).replace(/"/g,"&quot;")})">Load</button>
                <button class="btn btn-secondary" onclick="deleteProfile('${t.name}')">Delete</button>
            </div>
        </div>
    `).join("")}function qn(){Nn.addEventListener("click",K),Rn.addEventListener("click",K),Pn.addEventListener("click",jn),F.addEventListener("click",e=>{e.target===F&&K()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&F.classList.contains("active")&&K()})}function K(){F.classList.remove("active"),De.value="",Ke.value=""}function Vn(){if(M.length===0){alert("No saved profiles found."),K();return}const e=M.map(n=>`${n.name} (${n.type.toUpperCase()})`).join(`
`),t=prompt(`Select a profile to load:

${e}

Enter the profile name:`);if(t){const n=M.find(o=>o.name===t);n?yt(n):T("Profile not found","error")}}function T(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.innerHTML=`
        <div class="notification-content">
            <span class="notification-message">${e}</span>
            <button class="notification-close">&times;</button>
        </div>
    `,document.body.appendChild(n),setTimeout(()=>{n.classList.add("show")},100),setTimeout(()=>{Ge(n)},5e3),n.querySelector(".notification-close").addEventListener("click",()=>{Ge(n)})}function Ge(e){e.classList.remove("show"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}function zn(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})})}window.loadProfile=yt;window.deleteProfile=Fn;window.showNotification=T;function _n(){const e=document.getElementById("help-button"),t=document.getElementById("back-to-top");e&&e.addEventListener("click",()=>{q("help")}),t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),document.addEventListener("keydown",n=>{n.key==="F1"&&(n.preventDefault(),q("help"))})}function vt(e){const t=document.getElementById(`${e}-data-status`);t&&(t.style.display="flex",setTimeout(()=>{t.style.display="none"},5e3))}function Jn(){Yn(),Qn()}async function Yn(){try{const e=await(await fetch("/docs/matrix/version-matrix-web.json")).json(),t=document.getElementById("matrix-stats");if(!t)return;const n=e.preferences.length,o=e.versions.length;let r=0,a=0,i=0;e.preferences.forEach(s=>{let c=!1,l=!1;Object.values(s.versions).forEach(d=>{d.hide&&(c=!0),d.disable&&(l=!0)}),c&&l?i++:c?r++:l&&a++}),t.innerHTML=`
            <div class="matrix-stat">
                <div class="matrix-stat-number">${n}</div>
                <div class="matrix-stat-label">Total Preferences</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${o}</div>
                <div class="matrix-stat-label">ATAK Versions</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${r+i}</div>
                <div class="matrix-stat-label">Can Hide</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${a+i}</div>
                <div class="matrix-stat-label">Can Disable</div>
            </div>
        `}catch(e){console.error("Error loading matrix stats:",e);const t=document.getElementById("matrix-stats");t&&(t.innerHTML='<div class="error">Error loading matrix data</div>')}}function Qn(){const e=document.getElementById("download-matrix");e&&e.addEventListener("click",Wn)}async function Wn(){try{const e=await(await fetch("/docs/matrix/version-matrix.json")).json(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download="atak-version-matrix.json",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),T("Matrix data downloaded successfully","success")}catch(e){console.error("Error downloading matrix data:",e),T("Error downloading matrix data","error")}}
