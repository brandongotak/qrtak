(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();function zt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Q={},he,et;function Jt(){return et||(et=1,he=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),he}var pe={},K={},tt;function O(){if(tt)return K;tt=1;let e;const t=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return K.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17},K.getSymbolTotalCodewords=function(n){return t[n]},K.getBCHDigit=function(o){let n=0;for(;o!==0;)n++,o>>>=1;return n},K.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');e=n},K.isKanjiModeEnabled=function(){return typeof e<"u"},K.toSJIS=function(n){return e(n)},K}var ye={},nt;function je(){return nt||(nt=1,function(e){e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function t(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+o)}}e.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},e.from=function(n,r){if(e.isValid(n))return n;try{return t(n)}catch{return r}}}(ye)),ye}var ve,rt;function Qt(){if(rt)return ve;rt=1;function e(){this.buffer=[],this.length=0}return e.prototype={get:function(t){const o=Math.floor(t/8);return(this.buffer[o]>>>7-t%8&1)===1},put:function(t,o){for(let n=0;n<o;n++)this.putBit((t>>>o-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const o=Math.floor(this.length/8);this.buffer.length<=o&&this.buffer.push(0),t&&(this.buffer[o]|=128>>>this.length%8),this.length++}},ve=e,ve}var Ee,ot;function Gt(){if(ot)return Ee;ot=1;function e(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}return e.prototype.set=function(t,o,n,r){const i=t*this.size+o;this.data[i]=n,r&&(this.reservedBit[i]=!0)},e.prototype.get=function(t,o){return this.data[t*this.size+o]},e.prototype.xor=function(t,o,n){this.data[t*this.size+o]^=n},e.prototype.isReserved=function(t,o){return this.reservedBit[t*this.size+o]},Ee=e,Ee}var we={},it;function Yt(){return it||(it=1,function(e){const t=O().getSymbolSize;e.getRowColCoords=function(n){if(n===1)return[];const r=Math.floor(n/7)+2,i=t(n),a=i===145?26:Math.ceil((i-13)/(2*r-2))*2,c=[i-7];for(let s=1;s<r-1;s++)c[s]=c[s-1]-a;return c.push(6),c.reverse()},e.getPositions=function(n){const r=[],i=e.getRowColCoords(n),a=i.length;for(let c=0;c<a;c++)for(let s=0;s<a;s++)c===0&&s===0||c===0&&s===a-1||c===a-1&&s===0||r.push([i[c],i[s]]);return r}}(we)),we}var be={},at;function Wt(){if(at)return be;at=1;const e=O().getSymbolSize,t=7;return be.getPositions=function(n){const r=e(n);return[[0,0],[r-t,0],[0,r-t]]},be}var Be={},st;function Zt(){return st||(st=1,function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};e.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},e.from=function(r){return e.isValid(r)?parseInt(r,10):void 0},e.getPenaltyN1=function(r){const i=r.size;let a=0,c=0,s=0,l=null,u=null;for(let g=0;g<i;g++){c=s=0,l=u=null;for(let h=0;h<i;h++){let d=r.get(g,h);d===l?c++:(c>=5&&(a+=t.N1+(c-5)),l=d,c=1),d=r.get(h,g),d===u?s++:(s>=5&&(a+=t.N1+(s-5)),u=d,s=1)}c>=5&&(a+=t.N1+(c-5)),s>=5&&(a+=t.N1+(s-5))}return a},e.getPenaltyN2=function(r){const i=r.size;let a=0;for(let c=0;c<i-1;c++)for(let s=0;s<i-1;s++){const l=r.get(c,s)+r.get(c,s+1)+r.get(c+1,s)+r.get(c+1,s+1);(l===4||l===0)&&a++}return a*t.N2},e.getPenaltyN3=function(r){const i=r.size;let a=0,c=0,s=0;for(let l=0;l<i;l++){c=s=0;for(let u=0;u<i;u++)c=c<<1&2047|r.get(l,u),u>=10&&(c===1488||c===93)&&a++,s=s<<1&2047|r.get(u,l),u>=10&&(s===1488||s===93)&&a++}return a*t.N3},e.getPenaltyN4=function(r){let i=0;const a=r.data.length;for(let s=0;s<a;s++)i+=r.data[s];return Math.abs(Math.ceil(i*100/a/5)-10)*t.N4};function o(n,r,i){switch(n){case e.Patterns.PATTERN000:return(r+i)%2===0;case e.Patterns.PATTERN001:return r%2===0;case e.Patterns.PATTERN010:return i%3===0;case e.Patterns.PATTERN011:return(r+i)%3===0;case e.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(i/3))%2===0;case e.Patterns.PATTERN101:return r*i%2+r*i%3===0;case e.Patterns.PATTERN110:return(r*i%2+r*i%3)%2===0;case e.Patterns.PATTERN111:return(r*i%3+(r+i)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}e.applyMask=function(r,i){const a=i.size;for(let c=0;c<a;c++)for(let s=0;s<a;s++)i.isReserved(s,c)||i.xor(s,c,o(r,s,c))},e.getBestMask=function(r,i){const a=Object.keys(e.Patterns).length;let c=0,s=1/0;for(let l=0;l<a;l++){i(l),e.applyMask(l,r);const u=e.getPenaltyN1(r)+e.getPenaltyN2(r)+e.getPenaltyN3(r)+e.getPenaltyN4(r);e.applyMask(l,r),u<s&&(s=u,c=l)}return c}}(Be)),Be}var ae={},ct;function St(){if(ct)return ae;ct=1;const e=je(),t=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],o=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ae.getBlocksCount=function(r,i){switch(i){case e.L:return t[(r-1)*4+0];case e.M:return t[(r-1)*4+1];case e.Q:return t[(r-1)*4+2];case e.H:return t[(r-1)*4+3];default:return}},ae.getTotalCodewordsCount=function(r,i){switch(i){case e.L:return o[(r-1)*4+0];case e.M:return o[(r-1)*4+1];case e.Q:return o[(r-1)*4+2];case e.H:return o[(r-1)*4+3];default:return}},ae}var Ce={},ne={},lt;function Xt(){if(lt)return ne;lt=1;const e=new Uint8Array(512),t=new Uint8Array(256);return function(){let n=1;for(let r=0;r<255;r++)e[r]=n,t[n]=r,n<<=1,n&256&&(n^=285);for(let r=255;r<512;r++)e[r]=e[r-255]}(),ne.log=function(n){if(n<1)throw new Error("log("+n+")");return t[n]},ne.exp=function(n){return e[n]},ne.mul=function(n,r){return n===0||r===0?0:e[t[n]+t[r]]},ne}var ut;function en(){return ut||(ut=1,function(e){const t=Xt();e.mul=function(n,r){const i=new Uint8Array(n.length+r.length-1);for(let a=0;a<n.length;a++)for(let c=0;c<r.length;c++)i[a+c]^=t.mul(n[a],r[c]);return i},e.mod=function(n,r){let i=new Uint8Array(n);for(;i.length-r.length>=0;){const a=i[0];for(let s=0;s<r.length;s++)i[s]^=t.mul(r[s],a);let c=0;for(;c<i.length&&i[c]===0;)c++;i=i.slice(c)}return i},e.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let i=0;i<n;i++)r=e.mul(r,new Uint8Array([1,t.exp(i)]));return r}}(Ce)),Ce}var Ie,dt;function tn(){if(dt)return Ie;dt=1;const e=en();function t(o){this.genPoly=void 0,this.degree=o,this.degree&&this.initialize(this.degree)}return t.prototype.initialize=function(n){this.degree=n,this.genPoly=e.generateECPolynomial(this.degree)},t.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(n.length+this.degree);r.set(n);const i=e.mod(r,this.genPoly),a=this.degree-i.length;if(a>0){const c=new Uint8Array(this.degree);return c.set(i,a),c}return i},Ie=t,Ie}var ke={},Te={},Le={},ft;function Nt(){return ft||(ft=1,Le.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40}),Le}var U={},mt;function Dt(){if(mt)return U;mt=1;const e="[0-9]+",t="[A-Z $%*+\\-./:]+";let o="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";o=o.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+o+`)(?:.|[\r
]))+`;U.KANJI=new RegExp(o,"g"),U.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),U.BYTE=new RegExp(n,"g"),U.NUMERIC=new RegExp(e,"g"),U.ALPHANUMERIC=new RegExp(t,"g");const r=new RegExp("^"+o+"$"),i=new RegExp("^"+e+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return U.testKanji=function(s){return r.test(s)},U.testNumeric=function(s){return i.test(s)},U.testAlphanumeric=function(s){return a.test(s)},U}var gt;function x(){return gt||(gt=1,function(e){const t=Nt(),o=Dt();e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(i,a){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!t.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?i.ccBits[0]:a<27?i.ccBits[1]:i.ccBits[2]},e.getBestModeForData=function(i){return o.testNumeric(i)?e.NUMERIC:o.testAlphanumeric(i)?e.ALPHANUMERIC:o.testKanji(i)?e.KANJI:e.BYTE},e.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},e.isValid=function(i){return i&&i.bit&&i.ccBits};function n(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+r)}}e.from=function(i,a){if(e.isValid(i))return i;try{return n(i)}catch{return a}}}(Te)),Te}var ht;function nn(){return ht||(ht=1,function(e){const t=O(),o=St(),n=je(),r=x(),i=Nt(),a=7973,c=t.getBCHDigit(a);function s(h,d,T){for(let L=1;L<=40;L++)if(d<=e.getCapacity(L,T,h))return L}function l(h,d){return r.getCharCountIndicator(h,d)+4}function u(h,d){let T=0;return h.forEach(function(L){const A=l(L.mode,d);T+=A+L.getBitsLength()}),T}function g(h,d){for(let T=1;T<=40;T++)if(u(h,T)<=e.getCapacity(T,d,r.MIXED))return T}e.from=function(d,T){return i.isValid(d)?parseInt(d,10):T},e.getCapacity=function(d,T,L){if(!i.isValid(d))throw new Error("Invalid QR Code version");typeof L>"u"&&(L=r.BYTE);const A=t.getSymbolTotalCodewords(d),C=o.getTotalCodewordsCount(d,T),P=(A-C)*8;if(L===r.MIXED)return P;const I=P-l(L,d);switch(L){case r.NUMERIC:return Math.floor(I/10*3);case r.ALPHANUMERIC:return Math.floor(I/11*2);case r.KANJI:return Math.floor(I/13);case r.BYTE:default:return Math.floor(I/8)}},e.getBestVersionForData=function(d,T){let L;const A=n.from(T,n.M);if(Array.isArray(d)){if(d.length>1)return g(d,A);if(d.length===0)return 1;L=d[0]}else L=d;return s(L.mode,L.getLength(),A)},e.getEncodedBits=function(d){if(!i.isValid(d)||d<7)throw new Error("Invalid QR Code version");let T=d<<12;for(;t.getBCHDigit(T)-c>=0;)T^=a<<t.getBCHDigit(T)-c;return d<<12|T}}(ke)),ke}var Pe={},pt;function rn(){if(pt)return Pe;pt=1;const e=O(),t=1335,o=21522,n=e.getBCHDigit(t);return Pe.getEncodedBits=function(i,a){const c=i.bit<<3|a;let s=c<<10;for(;e.getBCHDigit(s)-n>=0;)s^=t<<e.getBCHDigit(s)-n;return(c<<10|s)^o},Pe}var Re={},Ae,yt;function on(){if(yt)return Ae;yt=1;const e=x();function t(o){this.mode=e.NUMERIC,this.data=o.toString()}return t.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(n){let r,i,a;for(r=0;r+3<=this.data.length;r+=3)i=this.data.substr(r,3),a=parseInt(i,10),n.put(a,10);const c=this.data.length-r;c>0&&(i=this.data.substr(r),a=parseInt(i,10),n.put(a,c*3+1))},Ae=t,Ae}var Me,vt;function an(){if(vt)return Me;vt=1;const e=x(),t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function o(n){this.mode=e.ALPHANUMERIC,this.data=n}return o.getBitsLength=function(r){return 11*Math.floor(r/2)+6*(r%2)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(r){let i;for(i=0;i+2<=this.data.length;i+=2){let a=t.indexOf(this.data[i])*45;a+=t.indexOf(this.data[i+1]),r.put(a,11)}this.data.length%2&&r.put(t.indexOf(this.data[i]),6)},Me=o,Me}var Se,Et;function sn(){if(Et)return Se;Et=1;const e=x();function t(o){this.mode=e.BYTE,typeof o=="string"?this.data=new TextEncoder().encode(o):this.data=new Uint8Array(o)}return t.getBitsLength=function(n){return n*8},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(o){for(let n=0,r=this.data.length;n<r;n++)o.put(this.data[n],8)},Se=t,Se}var Ne,wt;function cn(){if(wt)return Ne;wt=1;const e=x(),t=O();function o(n){this.mode=e.KANJI,this.data=n}return o.getBitsLength=function(r){return r*13},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(n){let r;for(r=0;r<this.data.length;r++){let i=t.toSJIS(this.data[r]);if(i>=33088&&i<=40956)i-=33088;else if(i>=57408&&i<=60351)i-=49472;else throw new Error("Invalid SJIS character: "+this.data[r]+`
Make sure your charset is UTF-8`);i=(i>>>8&255)*192+(i&255),n.put(i,13)}},Ne=o,Ne}var De={exports:{}},bt;function ln(){return bt||(bt=1,function(e){var t={single_source_shortest_paths:function(o,n,r){var i={},a={};a[n]=0;var c=t.PriorityQueue.make();c.push(n,0);for(var s,l,u,g,h,d,T,L,A;!c.empty();){s=c.pop(),l=s.value,g=s.cost,h=o[l]||{};for(u in h)h.hasOwnProperty(u)&&(d=h[u],T=g+d,L=a[u],A=typeof a[u]>"u",(A||L>T)&&(a[u]=T,c.push(u,T),i[u]=l))}if(typeof r<"u"&&typeof a[r]>"u"){var C=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(C)}return i},extract_shortest_path_from_predecessor_list:function(o,n){for(var r=[],i=n;i;)r.push(i),o[i],i=o[i];return r.reverse(),r},find_path:function(o,n,r){var i=t.single_source_shortest_paths(o,n,r);return t.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(o){var n=t.PriorityQueue,r={},i;o=o||{};for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);return r.queue=[],r.sorter=o.sorter||n.default_sorter,r},default_sorter:function(o,n){return o.cost-n.cost},push:function(o,n){var r={value:o,cost:n};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};e.exports=t}(De)),De.exports}var Bt;function un(){return Bt||(Bt=1,function(e){const t=x(),o=on(),n=an(),r=sn(),i=cn(),a=Dt(),c=O(),s=ln();function l(C){return unescape(encodeURIComponent(C)).length}function u(C,P,I){const b=[];let M;for(;(M=C.exec(I))!==null;)b.push({data:M[0],index:M.index,mode:P,length:M[0].length});return b}function g(C){const P=u(a.NUMERIC,t.NUMERIC,C),I=u(a.ALPHANUMERIC,t.ALPHANUMERIC,C);let b,M;return c.isKanjiModeEnabled()?(b=u(a.BYTE,t.BYTE,C),M=u(a.KANJI,t.KANJI,C)):(b=u(a.BYTE_KANJI,t.BYTE,C),M=[]),P.concat(I,b,M).sort(function(E,v){return E.index-v.index}).map(function(E){return{data:E.data,mode:E.mode,length:E.length}})}function h(C,P){switch(P){case t.NUMERIC:return o.getBitsLength(C);case t.ALPHANUMERIC:return n.getBitsLength(C);case t.KANJI:return i.getBitsLength(C);case t.BYTE:return r.getBitsLength(C)}}function d(C){return C.reduce(function(P,I){const b=P.length-1>=0?P[P.length-1]:null;return b&&b.mode===I.mode?(P[P.length-1].data+=I.data,P):(P.push(I),P)},[])}function T(C){const P=[];for(let I=0;I<C.length;I++){const b=C[I];switch(b.mode){case t.NUMERIC:P.push([b,{data:b.data,mode:t.ALPHANUMERIC,length:b.length},{data:b.data,mode:t.BYTE,length:b.length}]);break;case t.ALPHANUMERIC:P.push([b,{data:b.data,mode:t.BYTE,length:b.length}]);break;case t.KANJI:P.push([b,{data:b.data,mode:t.BYTE,length:l(b.data)}]);break;case t.BYTE:P.push([{data:b.data,mode:t.BYTE,length:l(b.data)}])}}return P}function L(C,P){const I={},b={start:{}};let M=["start"];for(let m=0;m<C.length;m++){const E=C[m],v=[];for(let f=0;f<E.length;f++){const B=E[f],p=""+m+f;v.push(p),I[p]={node:B,lastCount:0},b[p]={};for(let w=0;w<M.length;w++){const y=M[w];I[y]&&I[y].node.mode===B.mode?(b[y][p]=h(I[y].lastCount+B.length,B.mode)-h(I[y].lastCount,B.mode),I[y].lastCount+=B.length):(I[y]&&(I[y].lastCount=B.length),b[y][p]=h(B.length,B.mode)+4+t.getCharCountIndicator(B.mode,P))}}M=v}for(let m=0;m<M.length;m++)b[M[m]].end=0;return{map:b,table:I}}function A(C,P){let I;const b=t.getBestModeForData(C);if(I=t.from(P,b),I!==t.BYTE&&I.bit<b.bit)throw new Error('"'+C+'" cannot be encoded with mode '+t.toString(I)+`.
 Suggested mode is: `+t.toString(b));switch(I===t.KANJI&&!c.isKanjiModeEnabled()&&(I=t.BYTE),I){case t.NUMERIC:return new o(C);case t.ALPHANUMERIC:return new n(C);case t.KANJI:return new i(C);case t.BYTE:return new r(C)}}e.fromArray=function(P){return P.reduce(function(I,b){return typeof b=="string"?I.push(A(b,null)):b.data&&I.push(A(b.data,b.mode)),I},[])},e.fromString=function(P,I){const b=g(P,c.isKanjiModeEnabled()),M=T(b),m=L(M,I),E=s.find_path(m.map,"start","end"),v=[];for(let f=1;f<E.length-1;f++)v.push(m.table[E[f]].node);return e.fromArray(d(v))},e.rawSplit=function(P){return e.fromArray(g(P,c.isKanjiModeEnabled()))}}(Re)),Re}var Ct;function dn(){if(Ct)return pe;Ct=1;const e=O(),t=je(),o=Qt(),n=Gt(),r=Yt(),i=Wt(),a=Zt(),c=St(),s=tn(),l=nn(),u=rn(),g=x(),h=un();function d(m,E){const v=m.size,f=i.getPositions(E);for(let B=0;B<f.length;B++){const p=f[B][0],w=f[B][1];for(let y=-1;y<=7;y++)if(!(p+y<=-1||v<=p+y))for(let k=-1;k<=7;k++)w+k<=-1||v<=w+k||(y>=0&&y<=6&&(k===0||k===6)||k>=0&&k<=6&&(y===0||y===6)||y>=2&&y<=4&&k>=2&&k<=4?m.set(p+y,w+k,!0,!0):m.set(p+y,w+k,!1,!0))}}function T(m){const E=m.size;for(let v=8;v<E-8;v++){const f=v%2===0;m.set(v,6,f,!0),m.set(6,v,f,!0)}}function L(m,E){const v=r.getPositions(E);for(let f=0;f<v.length;f++){const B=v[f][0],p=v[f][1];for(let w=-2;w<=2;w++)for(let y=-2;y<=2;y++)w===-2||w===2||y===-2||y===2||w===0&&y===0?m.set(B+w,p+y,!0,!0):m.set(B+w,p+y,!1,!0)}}function A(m,E){const v=m.size,f=l.getEncodedBits(E);let B,p,w;for(let y=0;y<18;y++)B=Math.floor(y/3),p=y%3+v-8-3,w=(f>>y&1)===1,m.set(B,p,w,!0),m.set(p,B,w,!0)}function C(m,E,v){const f=m.size,B=u.getEncodedBits(E,v);let p,w;for(p=0;p<15;p++)w=(B>>p&1)===1,p<6?m.set(p,8,w,!0):p<8?m.set(p+1,8,w,!0):m.set(f-15+p,8,w,!0),p<8?m.set(8,f-p-1,w,!0):p<9?m.set(8,15-p-1+1,w,!0):m.set(8,15-p-1,w,!0);m.set(f-8,8,1,!0)}function P(m,E){const v=m.size;let f=-1,B=v-1,p=7,w=0;for(let y=v-1;y>0;y-=2)for(y===6&&y--;;){for(let k=0;k<2;k++)if(!m.isReserved(B,y-k)){let H=!1;w<E.length&&(H=(E[w]>>>p&1)===1),m.set(B,y-k,H),p--,p===-1&&(w++,p=7)}if(B+=f,B<0||v<=B){B-=f,f=-f;break}}}function I(m,E,v){const f=new o;v.forEach(function(k){f.put(k.mode.bit,4),f.put(k.getLength(),g.getCharCountIndicator(k.mode,m)),k.write(f)});const B=e.getSymbolTotalCodewords(m),p=c.getTotalCodewordsCount(m,E),w=(B-p)*8;for(f.getLengthInBits()+4<=w&&f.put(0,4);f.getLengthInBits()%8!==0;)f.putBit(0);const y=(w-f.getLengthInBits())/8;for(let k=0;k<y;k++)f.put(k%2?17:236,8);return b(f,m,E)}function b(m,E,v){const f=e.getSymbolTotalCodewords(E),B=c.getTotalCodewordsCount(E,v),p=f-B,w=c.getBlocksCount(E,v),y=f%w,k=w-y,H=Math.floor(f/w),te=Math.floor(p/w),jt=te+1,We=H-te,Ot=new s(We);let de=0;const ie=new Array(w),Ze=new Array(w);let fe=0;const xt=new Uint8Array(m.buffer);for(let J=0;J<w;J++){const ge=J<k?te:jt;ie[J]=xt.slice(de,de+ge),Ze[J]=Ot.encode(ie[J]),de+=ge,fe=Math.max(fe,ge)}const me=new Uint8Array(f);let Xe=0,q,F;for(q=0;q<fe;q++)for(F=0;F<w;F++)q<ie[F].length&&(me[Xe++]=ie[F][q]);for(q=0;q<We;q++)for(F=0;F<w;F++)me[Xe++]=Ze[F][q];return me}function M(m,E,v,f){let B;if(Array.isArray(m))B=h.fromArray(m);else if(typeof m=="string"){let H=E;if(!H){const te=h.rawSplit(m);H=l.getBestVersionForData(te,v)}B=h.fromString(m,H||40)}else throw new Error("Invalid data");const p=l.getBestVersionForData(B,v);if(!p)throw new Error("The amount of data is too big to be stored in a QR Code");if(!E)E=p;else if(E<p)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+p+`.
`);const w=I(E,v,B),y=e.getSymbolSize(E),k=new n(y);return d(k,E),T(k),L(k,E),C(k,v,0),E>=7&&A(k,E),P(k,w),isNaN(f)&&(f=a.getBestMask(k,C.bind(null,k,v))),a.applyMask(f,k),C(k,v,f),{modules:k,version:E,errorCorrectionLevel:v,maskPattern:f,segments:B}}return pe.create=function(E,v){if(typeof E>"u"||E==="")throw new Error("No input text");let f=t.M,B,p;return typeof v<"u"&&(f=t.from(v.errorCorrectionLevel,t.M),B=l.from(v.version),p=a.from(v.maskPattern),v.toSJISFunc&&e.setToSJISFunction(v.toSJISFunc)),M(E,B,f,p)},pe}var $e={},Ue={},It;function $t(){return It||(It=1,function(e){function t(o){if(typeof o=="number"&&(o=o.toString()),typeof o!="string")throw new Error("Color should be defined as hex string");let n=o.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+o);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(i){return[i,i]}))),n.length===6&&n.push("F","F");const r=parseInt(n.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+n.slice(0,6).join("")}}e.getOptions=function(n){n||(n={}),n.color||(n.color={});const r=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,i=n.width&&n.width>=21?n.width:void 0,a=n.scale||4;return{width:i,scale:i?4:a,margin:r,color:{dark:t(n.color.dark||"#000000ff"),light:t(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},e.getScale=function(n,r){return r.width&&r.width>=n+r.margin*2?r.width/(n+r.margin*2):r.scale},e.getImageWidth=function(n,r){const i=e.getScale(n,r);return Math.floor((n+r.margin*2)*i)},e.qrToImageData=function(n,r,i){const a=r.modules.size,c=r.modules.data,s=e.getScale(a,i),l=Math.floor((a+i.margin*2)*s),u=i.margin*s,g=[i.color.light,i.color.dark];for(let h=0;h<l;h++)for(let d=0;d<l;d++){let T=(h*l+d)*4,L=i.color.light;if(h>=u&&d>=u&&h<l-u&&d<l-u){const A=Math.floor((h-u)/s),C=Math.floor((d-u)/s);L=g[c[A*a+C]?1:0]}n[T++]=L.r,n[T++]=L.g,n[T++]=L.b,n[T]=L.a}}}(Ue)),Ue}var kt;function fn(){return kt||(kt=1,function(e){const t=$t();function o(r,i,a){r.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=a,i.width=a,i.style.height=a+"px",i.style.width=a+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}e.render=function(i,a,c){let s=c,l=a;typeof s>"u"&&(!a||!a.getContext)&&(s=a,a=void 0),a||(l=n()),s=t.getOptions(s);const u=t.getImageWidth(i.modules.size,s),g=l.getContext("2d"),h=g.createImageData(u,u);return t.qrToImageData(h.data,i,s),o(g,l,u),g.putImageData(h,0,0),l},e.renderToDataURL=function(i,a,c){let s=c;typeof s>"u"&&(!a||!a.getContext)&&(s=a,a=void 0),s||(s={});const l=e.render(i,a,s),u=s.type||"image/png",g=s.rendererOpts||{};return l.toDataURL(u,g.quality)}}($e)),$e}var qe={},Tt;function mn(){if(Tt)return qe;Tt=1;const e=$t();function t(r,i){const a=r.a/255,c=i+'="'+r.hex+'"';return a<1?c+" "+i+'-opacity="'+a.toFixed(2).slice(1)+'"':c}function o(r,i,a){let c=r+i;return typeof a<"u"&&(c+=" "+a),c}function n(r,i,a){let c="",s=0,l=!1,u=0;for(let g=0;g<r.length;g++){const h=Math.floor(g%i),d=Math.floor(g/i);!h&&!l&&(l=!0),r[g]?(u++,g>0&&h>0&&r[g-1]||(c+=l?o("M",h+a,.5+d+a):o("m",s,0),s=0,l=!1),h+1<i&&r[g+1]||(c+=o("h",u),u=0)):s++}return c}return qe.render=function(i,a,c){const s=e.getOptions(a),l=i.modules.size,u=i.modules.data,g=l+s.margin*2,h=s.color.light.a?"<path "+t(s.color.light,"fill")+' d="M0 0h'+g+"v"+g+'H0z"/>':"",d="<path "+t(s.color.dark,"stroke")+' d="'+n(u,l,s.margin)+'"/>',T='viewBox="0 0 '+g+" "+g+'"',A='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+T+' shape-rendering="crispEdges">'+h+d+`</svg>
`;return typeof c=="function"&&c(null,A),A},qe}var Lt;function gn(){if(Lt)return Q;Lt=1;const e=Jt(),t=dn(),o=fn(),n=mn();function r(i,a,c,s,l){const u=[].slice.call(arguments,1),g=u.length,h=typeof u[g-1]=="function";if(!h&&!e())throw new Error("Callback required as last argument");if(h){if(g<2)throw new Error("Too few arguments provided");g===2?(l=c,c=a,a=s=void 0):g===3&&(a.getContext&&typeof l>"u"?(l=s,s=void 0):(l=s,s=c,c=a,a=void 0))}else{if(g<1)throw new Error("Too few arguments provided");return g===1?(c=a,a=s=void 0):g===2&&!a.getContext&&(s=c,c=a,a=void 0),new Promise(function(d,T){try{const L=t.create(c,s);d(i(L,a,s))}catch(L){T(L)}})}try{const d=t.create(c,s);l(null,i(d,a,s))}catch(d){l(d)}}return Q.create=t.create,Q.toCanvas=r.bind(null,o.render),Q.toDataURL=r.bind(null,o.renderToDataURL),Q.toString=r.bind(null,function(i,a,c){return n.render(i,c)}),Q}var hn=gn();const Ut=zt(hn);let S=null;const R=new Map;let oe=[],$=null;const G=document.getElementById("preference-category"),Ke=document.getElementById("preference-search"),Pt=document.getElementById("clear-preferences"),se=document.getElementById("preferences-list"),Rt=document.getElementById("selected-preferences"),At=document.getElementById("selected-list"),pn=document.getElementById("preference-count"),qt=document.querySelectorAll(".template-btn"),V=document.getElementById("preferences-qr"),ce=document.getElementById("preferences-download"),le=document.getElementById("preferences-copy"),ue=document.getElementById("preferences-package"),_=document.getElementById("atak-version"),Ve=document.getElementById("hide-disable-toggle"),yn=document.getElementById("hide-disable-container");async function vn(){await wn(),await bn(),Cn(),In(),S&&S.preferenceKeys?oe=Object.entries(S.preferenceKeys):oe=[],z()}function En(){z()}async function wn(){try{const e=await fetch("/docs/reference/ATAK-Preference-Keys-Data.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);S=await e.json()}catch{S={metadata:{totalKeys:0},preferenceKeys:{locationCallsign:{name:"My Callsign",type:"string",category:"identity",description:"User's callsign identifier",defaultValue:"",allowedValues:["alphanumeric"]},locationTeam:{name:"My Team",type:"string",category:"identity",description:"Team color affiliation",defaultValue:"White",allowedValues:["White","Yellow","Orange","Magenta","Red","Maroon","Purple","Dark Blue","Blue","Cyan","Teal","Green","Dark Green","Brown"]},atakRoleType:{name:"My Role",type:"string",category:"identity",description:"User's operational role",defaultValue:"Team Member",allowedValues:["Team Member","Team Lead","HQ","Sniper","Medic","Forward Observer","RTO","K9"]}}}}}async function bn(){try{const e=[{version:"5.4.0",file:"5.4.0-prefs.txt"},{version:"5.2.0.0",file:"5.2.0.0-prefs.txt"},{version:"5.0",file:"5.0-preferences.txt"},{version:"4.8.1",file:"4.8.1-preferences.txt"}];$={};for(const{version:n,file:r}of e)try{const a=await(await fetch(`/docs/versions/${r}`)).text();$[n]=Bn(a)}catch{}const t="locationCallsign";for(const[,n]of Object.entries($)){const r=n.hide.has(t)||n.disable.has(t)}const o=Object.keys(S.preferenceKeys).slice(0,5);for(const n of Object.keys($))for(const r of o){const i=$[n],a=i.hide.has(r),c=i.disable.has(r)}}catch{$={}}}function Bn(e){const t={hide:new Map,disable:new Map},o=e.split(`
`);for(const n of o){const r=n.match(/'([^']+)',\s*'([^']+)'/);if(r){const[,i,a]=r,c=/^[a-zA-Z][a-zA-Z0-9_]*$/.test(i)&&!i.includes(" "),s=/^[a-zA-Z][a-zA-Z0-9_]*$/.test(a)&&!a.includes(" ");let l,u;c&&!s?(l=i,u=a):!c&&s?(l=a,u=i):(l=i,u=a),t.hide.set(l,u),t.disable.set(l,u)}}return t}function Cn(){G&&G.addEventListener("change",Fe),Ke&&Ke.addEventListener("input",Fe),Pt&&Pt.addEventListener("click",Sn),qt.forEach(e=>{e.addEventListener("click",()=>Nn(e.dataset.template))}),ce&&ce.addEventListener("click",()=>Dn()),le&&le.addEventListener("click",()=>$n()),ue&&ue.addEventListener("click",Un),_&&_.addEventListener("change",Fe),Ve&&Ve.addEventListener("change",kn)}function In(){if(!_)return;const e=Object.keys($).sort((t,o)=>{const n=t.split(".").map(Number),r=o.split(".").map(Number);for(let i=0;i<Math.max(n.length,r.length);i++){const a=n[i]||0,c=r[i]||0;if(a!==c)return c-a}return 0});_.innerHTML='<option value="">All Versions</option>',e.forEach(t=>{const o=document.createElement("option");o.value=t,o.textContent=`ATAK ${t}`,_.appendChild(o)}),G&&S&&S.metadata&&S.metadata.categories&&(G.innerHTML='<option value="">All Categories</option>',S.metadata.categories.forEach(t=>{const o=document.createElement("option");o.value=t,o.textContent=t.charAt(0).toUpperCase()+t.slice(1),G.appendChild(o)}))}function kn(){const e=Ve.checked,t=yn;e?(t.style.display="block",t.innerHTML=`
            <div class="hide-disable-controls">
                <div class="control-group">
                    <label>Action Type:</label>
                    <select id="action-type" class="form-select">
                        <option value="hide">Hide Preferences</option>
                        <option value="disable">Disable Preferences</option>
                        <option value="both">Both Hide & Disable</option>
                    </select>
                </div>
                <div class="control-group">
                    <button id="apply-hide-disable" class="btn btn-warning">Apply to Selected</button>
                </div>
            </div>
            <div class="hide-disable-info">
                <p><strong>Hide:</strong> Preferences are completely hidden from the user interface</p>
                <p><strong>Disable:</strong> Preferences are visible but grayed out and non-interactive</p>
            </div>
        `,setTimeout(()=>{const o=document.getElementById("apply-hide-disable");o&&o.addEventListener("click",Tn)},100)):t.style.display="none"}function Tn(){const e=document.getElementById("action-type").value,t=Array.from(R.keys());t.length!==0&&(t.forEach(o=>{S.preferenceKeys[o]&&((e==="hide"||e==="both")&&R.set(`hidePreferenceItem_${o}`,!0),(e==="disable"||e==="both")&&R.set(`disablePreferenceItem_${o}`,!0))}),X(),ee(),`${e}${t.length}`,void 0)}function Fe(){const e=G.value,t=Ke.value.toLowerCase(),o=_?_.value:"";oe=Object.entries(S.preferenceKeys).filter(([n,r])=>{const i=!e||r.category===e,a=!t||n.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||r.description.toLowerCase().includes(t);let c=!0;if(o&&$[o]){const s=$[o],l=s.hide.has(n),u=s.disable.has(n);c=l||u}return i&&a&&c}).sort(([,n],[,r])=>n.name.localeCompare(r.name)),z()}function z(){if(!se)return;if(se.innerHTML="",oe.length===0){se.innerHTML='<div class="no-results">No preferences found matching your criteria.</div>';return}const e=_?_.value:"";oe.forEach(([t,o])=>{const n=Ln(t,o,e);se.appendChild(n)})}function Ln(e,t,o){const n=document.createElement("div");n.className="preference-item",R.has(e)&&n.classList.add("selected");const i=R.has(e)?R.get(e):t.defaultValue;let a="";if(o&&$[o]){const s=$[o],l=s.hide.has(e),u=s.disable.has(e);(l||u)&&(a=`
                <div class="version-info">
                    <span class="version-badge">ATAK ${o}</span>
                    ${l?'<span class="hide-badge">Hide</span>':""}
                    ${u?'<span class="disable-badge">Disable</span>':""}
                </div>
            `)}n.innerHTML=`
        <div class="preference-header">
            <div class="preference-name">${t.name}</div>
            <div class="preference-category">${t.category}</div>
            ${a}
        </div>
        <div class="preference-description">${t.description}</div>
        <div class="preference-control">
            <label>Value:</label>
            ${Pn(e,t,i)}
        </div>
        <div class="preference-validation" id="validation-${e}"></div>
    `,n.addEventListener("click",s=>{s.target.matches("input, select")||Rn(e,t)});const c=n.querySelector("input, select");return c&&(c.addEventListener("change",s=>{An(e,s.target.value)}),c.addEventListener("input",s=>{Mn(e,t,s.target.value)})),n}function Pn(e,t,o){switch(t.type){case"boolean":return`
                <select>
                    <option value="true" ${o===!0||o==="true"?"selected":""}>true</option>
                    <option value="false" ${o===!1||o==="false"?"selected":""}>false</option>
                </select>
            `;case"string":return t.allowedValues&&Array.isArray(t.allowedValues)?`
                    <select>
                        ${t.allowedValues.map(n=>`<option value="${n}" ${o===n?"selected":""}>${n}</option>`).join("")}
                    </select>
                `:`<input type="text" value="${o||""}" placeholder="Enter value">`;case"int":case"long":return`<input type="number" value="${o||""}" placeholder="Enter number">`;default:return`<input type="text" value="${o||""}" placeholder="Enter value">`}}function Rn(e,t){R.has(e)?R.delete(e):R.set(e,t.defaultValue),z(),X(),ee()}function An(e,t){R.has(e)&&(R.set(e,t),X(),ee())}function Mn(e,t,o){const n=document.getElementById(`validation-${e}`);if(!n)return;let r=!0,i="";switch(t.type){case"boolean":r=o==="true"||o==="false";break;case"int":case"long":r=!isNaN(o)&&Number.isInteger(Number(o)),r&&t.validation&&(t.validation.minValue!==void 0&&Number(o)<t.validation.minValue&&(r=!1,i=`Minimum value: ${t.validation.minValue}`),t.validation.maxValue!==void 0&&Number(o)>t.validation.maxValue&&(r=!1,i=`Maximum value: ${t.validation.maxValue}`));break;case"string":t.validation&&(t.validation.minLength!==void 0&&o.length<t.validation.minLength&&(r=!1,i=`Minimum length: ${t.validation.minLength}`),t.validation.maxLength!==void 0&&o.length>t.validation.maxLength&&(r=!1,i=`Maximum length: ${t.validation.maxLength}`),t.validation.pattern&&!new RegExp(t.validation.pattern).test(o)&&(r=!1,i="Invalid format"));break}n.className=`preference-validation ${r?"":"error"}`,n.textContent=i}function X(){if(R.size===0){Rt.style.display="none";return}Rt.style.display="block",pn.textContent=R.size,At.innerHTML="",R.forEach((e,t)=>{const o=S.preferenceKeys[t];if(!o)return;const n=document.createElement("div");n.className="selected-item",n.innerHTML=`
            <div class="selected-item-info">
                <div class="selected-item-name">${o.name}</div>
                <div class="selected-item-value">${t} = ${e}</div>
            </div>
            <button class="selected-item-remove" onclick="removePreference('${t}')">Remove</button>
        `,At.appendChild(n)})}window.removePreference=function(e){R.delete(e),z(),X(),ee()};function Sn(){R.clear(),z(),X(),ee()}function Nn(e){R.clear();const o={fire:{locationTeam:"Red",atakRoleType:"Team Lead",coord_display_pref:"UTM",largeTextMode:!0,dispatchLocationCotExternal:!0},police:{locationTeam:"Blue",atakRoleType:"Team Member",mockingOption:"WRGPS",locationReportingStrategy:"Dynamic",dispatchLocationCotExternal:!0},ems:{locationTeam:"Green",atakRoleType:"Medic",saHasPhoneNumber:!0,enableToast:!0,vibratePhone:!0,audibleNotify:!0},military:{locationTeam:"Dark Green",atakRoleType:"Team Lead",coord_display_pref:"MGRS",alt_display_pref:"HAE",useGPSTime:!0,dispatchLocationCotExternal:!0},sar:{locationTeam:"Orange",atakRoleType:"Team Member",coord_display_pref:"UTM",alt_unit_pref:"1",enableNonStreamingConnections:!0,dispatchLocationCotExternal:!0}}[e];o&&Object.entries(o).forEach(([n,r])=>{S.preferenceKeys[n]&&R.set(n,r)}),qt.forEach(n=>n.classList.remove("active")),event.target.classList.add("active"),z(),X(),ee()}async function ee(){if(R.size===0){V.innerHTML='<div class="qr-placeholder">Select preferences above to generate QR code</div>',ce.disabled=!0,le.disabled=!0,ue.disabled=!0;return}const e=[];let t=1;R.forEach((n,r)=>{const i=S.preferenceKeys[r];i&&(e.push(`key${t}=${encodeURIComponent(r)}`),e.push(`type${t}=${encodeURIComponent(i.type)}`),e.push(`value${t}=${encodeURIComponent(n)}`),t++)});const o=`tak://com.atakmap.app/preference?${e.join("&")}`;try{const n=await Ut.toCanvas(o,{width:256,margin:2,color:{dark:"#1e40af",light:"#ffffff"}});V.innerHTML="",V.appendChild(n),ce.disabled=!1,le.disabled=!1,ue.disabled=!1,V.dataset.url=o}catch{V.innerHTML='<div class="qr-placeholder">Error generating QR code</div>'}}async function Dn(e){const t=V.querySelector("canvas");if(!t)return;const o=document.createElement("a");o.download="atak-preferences.png",o.href=t.toDataURL(),o.click()}function $n(e){const{url:t}=V.dataset;t&&navigator.clipboard.writeText(t).then(()=>{}).catch(()=>{})}function Un(){if(R.size===0)return;const e=qn(),t=new Blob([e],{type:"application/xml"}),o=document.createElement("a");o.download="atak-config.pref",o.href=URL.createObjectURL(t),o.click()}function qn(){const e=[];return R.forEach((t,o)=>{const n=S.preferenceKeys[o];if(n){const r=Fn(n.type);e.push(`    <entry key="${o}" class="${r}">${t}</entry>`)}}),`<?xml version='1.0' encoding='ASCII' standalone='yes'?>
<preferences>
  <preference version="1" name="com.atakmap.app_preferences">
${e.join(`
`)}
  </preference>
</preferences>`}function Fn(e){switch(e){case"boolean":return"class java.lang.Boolean";case"int":return"class java.lang.Integer";case"long":return"class java.lang.Long";case"string":default:return"class java.lang.String"}}let re="atak",D=JSON.parse(localStorage.getItem("tak-profiles")||"[]");const Ft=document.querySelectorAll(".tab-btn"),_n=document.querySelectorAll(".tab-pane"),Y=document.getElementById("profile-modal"),Hn=document.querySelector(".modal-close"),Kn=document.getElementById("modal-cancel"),Vn=document.getElementById("modal-save"),Oe=document.getElementById("profile-name"),xe=document.getElementById("profile-description");document.addEventListener("DOMContentLoaded",async()=>{jn(),zn(),Jn(),Zn(),Ye(),await vn(),nr(),tr(),er()});function jn(){Ft.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;W(t)})})}function W(e){Ft.forEach(t=>t.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),_n.forEach(t=>t.classList.remove("active")),document.getElementById(`${e}-tab`).classList.add("active"),re==="atak"&&e==="itak"?On():re==="itak"&&e==="atak"&&xn(),e==="preferences"&&En(),re=e}function On(){const{value:e}=document.getElementById("atak-host");if(e.trim()){const t=document.getElementById("itak-url");t.value.trim()||(t.value=`https://${e.trim()}`,Je(),Vt("itak"),N("Server URL copied from ATAK tab","info"))}}function xn(){const{value:e}=document.getElementById("itak-url");if(e.trim()){let t="";try{const o=e.trim().startsWith("http")?e.trim():`https://${e.trim()}`;t=new URL(o).hostname}catch{const n=e.trim().replace(/^https?:\/\//,"").split("/"),[r]=n,[i]=r.split(":");t=i}if(t){const o=document.getElementById("atak-host");o.value.trim()||(o.value=t,ze(),Vt("atak"),N("Server hostname copied from iTAK tab","info"))}}}function zn(){[...document.getElementById("atak-form").querySelectorAll("input")].forEach(a=>{a.addEventListener("input",()=>ze())}),[...document.getElementById("itak-form").querySelectorAll("input, select")].forEach(a=>{a.addEventListener("input",()=>Je())}),[...document.getElementById("import-form").querySelectorAll("input")].forEach(a=>{a.addEventListener("input",()=>_t())}),document.getElementById("atak-download").addEventListener("click",()=>_e("atak")),document.getElementById("atak-copy").addEventListener("click",()=>He("atak")),document.getElementById("itak-download").addEventListener("click",()=>_e("itak")),document.getElementById("itak-copy").addEventListener("click",()=>He("itak")),document.getElementById("import-download").addEventListener("click",()=>_e("import")),document.getElementById("import-copy").addEventListener("click",()=>He("import"))}async function Z(e,t){const o=document.getElementById(t);if(!e)return o.innerHTML='<div class="qr-placeholder">Enter configuration details above</div>',null;try{const n=await Ut.toCanvas(e,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});return o.innerHTML="",o.appendChild(n),n}catch(n){console.error("Error generating QR code:",n)}}function ze(){const e=document.getElementById("atak-host").value,t=document.getElementById("atak-username").value,o=document.getElementById("atak-token").value;if(e.trim()&&t.trim()&&o.trim()){const n=`tak://com.atakmap.app/enroll?host=${encodeURIComponent(e.trim())}&username=${encodeURIComponent(t.trim())}&token=${encodeURIComponent(o.trim())}`;Z(n,"atak-qr"),Qe("atak")}else Z(null,"atak-qr"),Ge("atak")}function Je(){const e=document.getElementById("itak-description").value,t=document.getElementById("itak-url").value,o=document.getElementById("itak-port").value,n=document.getElementById("itak-protocol").value;let r="";try{if(t.trim()){const s=t.trim().startsWith("http")?t.trim():`https://${t.trim()}`;r=new URL(s).hostname}}catch{const l=t.trim().replace(/^https?:\/\//,"").split("/"),[u]=l,[g]=u.split(":");r=g}const i=n==="https"?"ssl":"tcp";if([e,r,o].every(s=>s&&s.trim()!=="")){const s=`${e.trim()},${r},${o.trim()},${i}`;Z(s,"itak-qr"),Qe("itak")}else Z(null,"itak-qr"),Ge("itak")}function _t(){const e=document.getElementById("import-url").value;if(e.trim()){const t=`tak://com.atakmap.app/import?url=${encodeURIComponent(e.trim())}`;Z(t,"import-qr"),Qe("import")}else Z(null,"import-qr"),Ge("import")}function Qe(e){document.getElementById(`${e}-download`).disabled=!1,document.getElementById(`${e}-copy`).disabled=!1}function Ge(e){document.getElementById(`${e}-download`).disabled=!0,document.getElementById(`${e}-copy`).disabled=!0}async function _e(e){const o=document.getElementById(`${e}-qr`).querySelector("canvas");if(o)try{const n=document.createElement("a");n.download=`tak-${e}-config.png`,n.href=o.toDataURL(),n.click()}catch(n){console.error("Error downloading QR code:",n),N("Error downloading QR code","error")}}async function He(e){let t="";switch(e){case"atak":{const o=document.getElementById("atak-host").value,n=document.getElementById("atak-username").value,r=document.getElementById("atak-token").value;t=`tak://com.atakmap.app/enroll?host=${encodeURIComponent(o.trim())}&username=${encodeURIComponent(n.trim())}&token=${encodeURIComponent(r.trim())}`;break}case"itak":{const o=document.getElementById("itak-description").value,n=document.getElementById("itak-url").value,r=document.getElementById("itak-port").value,i=document.getElementById("itak-protocol").value;let a="";try{if(n.trim()){const s=n.trim().startsWith("http")?n.trim():`https://${n.trim()}`;a=new URL(s).hostname}}catch{const l=n.trim().replace(/^https?:\/\//,"").split("/"),[u]=l,[g]=u.split(":");a=g}const c=i==="https"?"ssl":"tcp";t=`${o.trim()},${a},${r.trim()},${c}`;break}case"import":{const o=document.getElementById("import-url").value;t=`tak://com.atakmap.app/import?url=${encodeURIComponent(o.trim())}`;break}}try{await navigator.clipboard.writeText(t),N("URI copied to clipboard!","success")}catch(o){console.error("Error copying to clipboard:",o),N("Error copying to clipboard","error")}}function Jn(){document.getElementById("save-profile").addEventListener("click",()=>{Qn()}),document.getElementById("load-profile").addEventListener("click",()=>{Gn()})}function Qn(){document.getElementById("modal-title").textContent="Save Profile",Y.classList.add("active");const e=Ht();e.name&&(Oe.value=e.name,xe.value=e.description||"")}function Gn(){document.getElementById("modal-title").textContent="Load Profile",Y.classList.add("active"),Xn()}function Ht(){const e={type:re,timestamp:Date.now()};switch(re){case"atak":{const t=document.getElementById("atak-host").value,o=document.getElementById("atak-username").value,n=document.getElementById("atak-token").value;e.host=t,e.username=o,e.token=n;break}case"itak":{const t=document.getElementById("itak-description").value,o=document.getElementById("itak-url").value,n=document.getElementById("itak-port").value,r=document.getElementById("itak-protocol").value;e.description=t,e.url=o,e.port=n,e.protocol=r;break}case"import":{const t=document.getElementById("import-url").value;e.url=t;break}}return e}function Yn(){const e=Oe.value.trim(),t=xe.value.trim();if(!e){N("Profile name is required","error");return}const o=Ht();o.name=e,o.description=t;const n=D.findIndex(r=>r.name===e);n>=0?D[n]=o:D.push(o),localStorage.setItem("tak-profiles",JSON.stringify(D)),Ye(),j(),N("Profile saved successfully!","success")}function Kt(e){switch(e.type){case"atak":{document.getElementById("atak-host").value=e.host||"",document.getElementById("atak-username").value=e.username||"",document.getElementById("atak-token").value=e.token||"",ze(),W("atak");break}case"itak":{document.getElementById("itak-description").value=e.description||"",document.getElementById("itak-url").value=e.url||"",document.getElementById("itak-port").value=e.port||"8089",document.getElementById("itak-protocol").value=e.protocol||"https",Je(),W("itak");break}case"import":{document.getElementById("import-url").value=e.url||"",_t(),W("import");break}}j(),N("Profile loaded successfully!","success")}function Wn(e){window.confirm(`Are you sure you want to delete the profile "${e}"?`)&&(D=D.filter(t=>t.name!==e),localStorage.setItem("tak-profiles",JSON.stringify(D)),Ye(),N("Profile deleted successfully!","success"))}function Ye(){const e=document.getElementById("profiles-container");if(D.length===0){e.innerHTML='<p style="grid-column: 1 / -1; color: var(--text-secondary);">No saved profiles yet. Create your first profile to get started.</p>';return}e.innerHTML=D.map(t=>`
        <div class="profile-card">
            <h4>${t.name}</h4>
            <p>${t.description||"No description"}</p>
            <p><strong>Type:</strong> ${t.type.toUpperCase()}</p>
            <p><strong>Created:</strong> ${new Date(t.timestamp).toLocaleDateString()}</p>
            <div class="profile-actions">
                <button class="btn btn-primary" onclick="loadProfile(${JSON.stringify(t).replace(/"/g,"&quot;")})">Load</button>
                <button class="btn btn-secondary" onclick="deleteProfile('${t.name}')">Delete</button>
            </div>
        </div>
    `).join("")}function Zn(){Hn.addEventListener("click",j),Kn.addEventListener("click",j),Vn.addEventListener("click",Yn),Y.addEventListener("click",e=>{e.target===Y&&j()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Y.classList.contains("active")&&j()})}function j(){Y.classList.remove("active"),Oe.value="",xe.value=""}function Xn(){if(D.length===0){N("No saved profiles found.","info"),j();return}const e=D.map(o=>`${o.name} (${o.type.toUpperCase()})`).join(`
`),t=window.prompt(`Select a profile to load:

${e}

Enter the profile name:`);if(t){const o=D.find(n=>n.name===t);o?Kt(o):N("Profile not found","error")}}function N(e,t="info"){const o=document.createElement("div");o.className=`notification notification-${t}`,o.innerHTML=`
        <div class="notification-content">
            <span class="notification-message">${e}</span>
            <button class="notification-close">&times;</button>
        </div>
    `,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},100),setTimeout(()=>{Mt(o)},5e3),o.querySelector(".notification-close").addEventListener("click",()=>{Mt(o)})}function Mt(e){e.classList.remove("show"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}function er(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{}).catch(e=>{})})}window.loadProfile=Kt;window.deleteProfile=Wn;window.showNotification=N;function tr(){const e=document.getElementById("help-button"),t=document.getElementById("back-to-top");e&&e.addEventListener("click",()=>{W("help")}),t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),document.addEventListener("keydown",o=>{o.key==="F1"&&(o.preventDefault(),W("help"))})}function Vt(e){const t=document.getElementById(`${e}-data-status`);t&&(t.style.display="flex",setTimeout(()=>{t.style.display="none"},5e3))}function nr(){rr(),or()}async function rr(){try{const t=await(await fetch("/docs/matrix/version-matrix-web.json")).json(),o=document.getElementById("matrix-stats");if(!o)return;const n=t.preferences.length,r=t.versions.length;let i=0,a=0,c=0;t.preferences.forEach(s=>{let l=!1,u=!1;Object.values(s.versions).forEach(g=>{g.hide&&(l=!0),g.disable&&(u=!0)}),l&&u?c++:l?i++:u&&a++}),o.innerHTML=`
            <div class="matrix-stat">
                <div class="matrix-stat-number">${n}</div>
                <div class="matrix-stat-label">Total Preferences</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${r}</div>
                <div class="matrix-stat-label">ATAK Versions</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${i+c}</div>
                <div class="matrix-stat-label">Can Hide</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${a+c}</div>
                <div class="matrix-stat-label">Can Disable</div>
            </div>
        `}catch(e){console.error("Error loading matrix stats:",e);const t=document.getElementById("matrix-stats");t&&(t.innerHTML='<div class="error">Error loading matrix data</div>')}}function or(){const e=document.getElementById("download-matrix");e&&e.addEventListener("click",ir)}async function ir(){try{const t=await(await fetch("/docs/matrix/version-matrix.json")).json(),o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(o),r=document.createElement("a");r.href=n,r.download="atak-version-matrix.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),N("Matrix data downloaded successfully","success")}catch(e){console.error("Error downloading matrix data:",e),N("Error downloading matrix data","error")}}
