(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var G={},vt=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Ze={},P={};let $e;const wt=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];P.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};P.getSymbolTotalCodewords=function(t){return wt[t]};P.getBCHDigit=function(e){let t=0;for(;e!==0;)t++,e>>>=1;return t};P.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');$e=t};P.isKanjiModeEnabled=function(){return typeof $e<"u"};P.toSJIS=function(t){return $e(t)};var ge={};(function(e){e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function t(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+n)}}e.isValid=function(o){return o&&typeof o.bit<"u"&&o.bit>=0&&o.bit<4},e.from=function(o,r){if(e.isValid(o))return o;try{return t(o)}catch{return r}}})(ge);function Xe(){this.buffer=[],this.length=0}Xe.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let n=0;n<t;n++)this.putBit((e>>>t-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var bt=Xe;function re(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}re.prototype.set=function(e,t,n,o){const r=e*this.size+t;this.data[r]=n,o&&(this.reservedBit[r]=!0)};re.prototype.get=function(e,t){return this.data[e*this.size+t]};re.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n};re.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]};var Bt=re,et={};(function(e){const t=P.getSymbolSize;e.getRowColCoords=function(o){if(o===1)return[];const r=Math.floor(o/7)+2,i=t(o),a=i===145?26:Math.ceil((i-13)/(2*r-2))*2,c=[i-7];for(let s=1;s<r-1;s++)c[s]=c[s-1]-a;return c.push(6),c.reverse()},e.getPositions=function(o){const r=[],i=e.getRowColCoords(o),a=i.length;for(let c=0;c<a;c++)for(let s=0;s<a;s++)c===0&&s===0||c===0&&s===a-1||c===a-1&&s===0||r.push([i[c],i[s]]);return r}})(et);var tt={};const It=P.getSymbolSize,xe=7;tt.getPositions=function(t){const n=It(t);return[[0,0],[n-xe,0],[0,n-xe]]};var nt={};(function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};e.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},e.from=function(r){return e.isValid(r)?parseInt(r,10):void 0},e.getPenaltyN1=function(r){const i=r.size;let a=0,c=0,s=0,l=null,d=null;for(let v=0;v<i;v++){c=s=0,l=d=null;for(let g=0;g<i;g++){let u=r.get(v,g);u===l?c++:(c>=5&&(a+=t.N1+(c-5)),l=u,c=1),u=r.get(g,v),u===d?s++:(s>=5&&(a+=t.N1+(s-5)),d=u,s=1)}c>=5&&(a+=t.N1+(c-5)),s>=5&&(a+=t.N1+(s-5))}return a},e.getPenaltyN2=function(r){const i=r.size;let a=0;for(let c=0;c<i-1;c++)for(let s=0;s<i-1;s++){const l=r.get(c,s)+r.get(c,s+1)+r.get(c+1,s)+r.get(c+1,s+1);(l===4||l===0)&&a++}return a*t.N2},e.getPenaltyN3=function(r){const i=r.size;let a=0,c=0,s=0;for(let l=0;l<i;l++){c=s=0;for(let d=0;d<i;d++)c=c<<1&2047|r.get(l,d),d>=10&&(c===1488||c===93)&&a++,s=s<<1&2047|r.get(d,l),d>=10&&(s===1488||s===93)&&a++}return a*t.N3},e.getPenaltyN4=function(r){let i=0;const a=r.data.length;for(let s=0;s<a;s++)i+=r.data[s];return Math.abs(Math.ceil(i*100/a/5)-10)*t.N4};function n(o,r,i){switch(o){case e.Patterns.PATTERN000:return(r+i)%2===0;case e.Patterns.PATTERN001:return r%2===0;case e.Patterns.PATTERN010:return i%3===0;case e.Patterns.PATTERN011:return(r+i)%3===0;case e.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(i/3))%2===0;case e.Patterns.PATTERN101:return r*i%2+r*i%3===0;case e.Patterns.PATTERN110:return(r*i%2+r*i%3)%2===0;case e.Patterns.PATTERN111:return(r*i%3+(r+i)%2)%2===0;default:throw new Error("bad maskPattern:"+o)}}e.applyMask=function(r,i){const a=i.size;for(let c=0;c<a;c++)for(let s=0;s<a;s++)i.isReserved(s,c)||i.xor(s,c,n(r,s,c))},e.getBestMask=function(r,i){const a=Object.keys(e.Patterns).length;let c=0,s=1/0;for(let l=0;l<a;l++){i(l),e.applyMask(l,r);const d=e.getPenaltyN1(r)+e.getPenaltyN2(r)+e.getPenaltyN3(r)+e.getPenaltyN4(r);e.applyMask(l,r),d<s&&(s=d,c=l)}return c}})(nt);var me={};const F=ge,ie=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],ae=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];me.getBlocksCount=function(t,n){switch(n){case F.L:return ie[(t-1)*4+0];case F.M:return ie[(t-1)*4+1];case F.Q:return ie[(t-1)*4+2];case F.H:return ie[(t-1)*4+3];default:return}};me.getTotalCodewordsCount=function(t,n){switch(n){case F.L:return ae[(t-1)*4+0];case F.M:return ae[(t-1)*4+1];case F.Q:return ae[(t-1)*4+2];case F.H:return ae[(t-1)*4+3];default:return}};var ot={},he={};const ee=new Uint8Array(512),ce=new Uint8Array(256);(function(){let t=1;for(let n=0;n<255;n++)ee[n]=t,ce[t]=n,t<<=1,t&256&&(t^=285);for(let n=255;n<512;n++)ee[n]=ee[n-255]})();he.log=function(t){if(t<1)throw new Error("log("+t+")");return ce[t]};he.exp=function(t){return ee[t]};he.mul=function(t,n){return t===0||n===0?0:ee[ce[t]+ce[n]]};(function(e){const t=he;e.mul=function(o,r){const i=new Uint8Array(o.length+r.length-1);for(let a=0;a<o.length;a++)for(let c=0;c<r.length;c++)i[a+c]^=t.mul(o[a],r[c]);return i},e.mod=function(o,r){let i=new Uint8Array(o);for(;i.length-r.length>=0;){const a=i[0];for(let s=0;s<r.length;s++)i[s]^=t.mul(r[s],a);let c=0;for(;c<i.length&&i[c]===0;)c++;i=i.slice(c)}return i},e.generateECPolynomial=function(o){let r=new Uint8Array([1]);for(let i=0;i<o;i++)r=e.mul(r,new Uint8Array([1,t.exp(i)]));return r}})(ot);const rt=ot;function Ne(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}Ne.prototype.initialize=function(t){this.degree=t,this.genPoly=rt.generateECPolynomial(this.degree)};Ne.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(t.length+this.degree);n.set(t);const o=rt.mod(n,this.genPoly),r=this.degree-o.length;if(r>0){const i=new Uint8Array(this.degree);return i.set(o,r),i}return o};var Ct=Ne,it={},_={},De={};De.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var R={};const at="[0-9]+",kt="[A-Z $%*+\\-./:]+";let ne="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";ne=ne.replace(/u/g,"\\u");const Tt="(?:(?![A-Z0-9 $%*+\\-./:]|"+ne+`)(?:.|[\r
]))+`;R.KANJI=new RegExp(ne,"g");R.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");R.BYTE=new RegExp(Tt,"g");R.NUMERIC=new RegExp(at,"g");R.ALPHANUMERIC=new RegExp(kt,"g");const Lt=new RegExp("^"+ne+"$"),Pt=new RegExp("^"+at+"$"),At=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");R.testKanji=function(t){return Lt.test(t)};R.testNumeric=function(t){return Pt.test(t)};R.testAlphanumeric=function(t){return At.test(t)};(function(e){const t=De,n=R;e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(i,a){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!t.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?i.ccBits[0]:a<27?i.ccBits[1]:i.ccBits[2]},e.getBestModeForData=function(i){return n.testNumeric(i)?e.NUMERIC:n.testAlphanumeric(i)?e.ALPHANUMERIC:n.testKanji(i)?e.KANJI:e.BYTE},e.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},e.isValid=function(i){return i&&i.bit&&i.ccBits};function o(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+r)}}e.from=function(i,a){if(e.isValid(i))return i;try{return o(i)}catch{return a}}})(_);(function(e){const t=P,n=me,o=ge,r=_,i=De,a=7973,c=t.getBCHDigit(a);function s(g,u,p){for(let y=1;y<=40;y++)if(u<=e.getCapacity(y,p,g))return y}function l(g,u){return r.getCharCountIndicator(g,u)+4}function d(g,u){let p=0;return g.forEach(function(y){const k=l(y.mode,u);p+=k+y.getBitsLength()}),p}function v(g,u){for(let p=1;p<=40;p++)if(d(g,p)<=e.getCapacity(p,u,r.MIXED))return p}e.from=function(u,p){return i.isValid(u)?parseInt(u,10):p},e.getCapacity=function(u,p,y){if(!i.isValid(u))throw new Error("Invalid QR Code version");typeof y>"u"&&(y=r.BYTE);const k=t.getSymbolTotalCodewords(u),h=n.getTotalCodewordsCount(u,p),E=(k-h)*8;if(y===r.MIXED)return E;const m=E-l(y,u);switch(y){case r.NUMERIC:return Math.floor(m/10*3);case r.ALPHANUMERIC:return Math.floor(m/11*2);case r.KANJI:return Math.floor(m/13);case r.BYTE:default:return Math.floor(m/8)}},e.getBestVersionForData=function(u,p){let y;const k=o.from(p,o.M);if(Array.isArray(u)){if(u.length>1)return v(u,k);if(u.length===0)return 1;y=u[0]}else y=u;return s(y.mode,y.getLength(),k)},e.getEncodedBits=function(u){if(!i.isValid(u)||u<7)throw new Error("Invalid QR Code version");let p=u<<12;for(;t.getBCHDigit(p)-c>=0;)p^=a<<t.getBCHDigit(p)-c;return u<<12|p}})(it);var st={};const Te=P,ct=1335,Mt=21522,qe=Te.getBCHDigit(ct);st.getEncodedBits=function(t,n){const o=t.bit<<3|n;let r=o<<10;for(;Te.getBCHDigit(r)-qe>=0;)r^=ct<<Te.getBCHDigit(r)-qe;return(o<<10|r)^Mt};var lt={};const St=_;function x(e){this.mode=St.NUMERIC,this.data=e.toString()}x.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};x.prototype.getLength=function(){return this.data.length};x.prototype.getBitsLength=function(){return x.getBitsLength(this.data.length)};x.prototype.write=function(t){let n,o,r;for(n=0;n+3<=this.data.length;n+=3)o=this.data.substr(n,3),r=parseInt(o,10),t.put(r,10);const i=this.data.length-n;i>0&&(o=this.data.substr(n),r=parseInt(o,10),t.put(r,i*3+1))};var Rt=x;const $t=_,Ee=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function q(e){this.mode=$t.ALPHANUMERIC,this.data=e}q.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};q.prototype.getLength=function(){return this.data.length};q.prototype.getBitsLength=function(){return q.getBitsLength(this.data.length)};q.prototype.write=function(t){let n;for(n=0;n+2<=this.data.length;n+=2){let o=Ee.indexOf(this.data[n])*45;o+=Ee.indexOf(this.data[n+1]),t.put(o,11)}this.data.length%2&&t.put(Ee.indexOf(this.data[n]),6)};var Nt=q;const Dt=_;function J(e){this.mode=Dt.BYTE,typeof e=="string"?this.data=new TextEncoder().encode(e):this.data=new Uint8Array(e)}J.getBitsLength=function(t){return t*8};J.prototype.getLength=function(){return this.data.length};J.prototype.getBitsLength=function(){return J.getBitsLength(this.data.length)};J.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)};var Ut=J;const Ft=_,_t=P;function Q(e){this.mode=Ft.KANJI,this.data=e}Q.getBitsLength=function(t){return t*13};Q.prototype.getLength=function(){return this.data.length};Q.prototype.getBitsLength=function(){return Q.getBitsLength(this.data.length)};Q.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=_t.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),e.put(n,13)}};var Ht=Q,dt={exports:{}};(function(e){var t={single_source_shortest_paths:function(n,o,r){var i={},a={};a[o]=0;var c=t.PriorityQueue.make();c.push(o,0);for(var s,l,d,v,g,u,p,y,k;!c.empty();){s=c.pop(),l=s.value,v=s.cost,g=n[l]||{};for(d in g)g.hasOwnProperty(d)&&(u=g[d],p=v+u,y=a[d],k=typeof a[d]>"u",(k||y>p)&&(a[d]=p,c.push(d,p),i[d]=l))}if(typeof r<"u"&&typeof a[r]>"u"){var h=["Could not find a path from ",o," to ",r,"."].join("");throw new Error(h)}return i},extract_shortest_path_from_predecessor_list:function(n,o){for(var r=[],i=o;i;)r.push(i),n[i],i=n[i];return r.reverse(),r},find_path:function(n,o,r){var i=t.single_source_shortest_paths(n,o,r);return t.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(n){var o=t.PriorityQueue,r={},i;n=n||{};for(i in o)o.hasOwnProperty(i)&&(r[i]=o[i]);return r.queue=[],r.sorter=n.sorter||o.default_sorter,r},default_sorter:function(n,o){return n.cost-o.cost},push:function(n,o){var r={value:n,cost:o};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};e.exports=t})(dt);var Kt=dt.exports;(function(e){const t=_,n=Rt,o=Nt,r=Ut,i=Ht,a=R,c=P,s=Kt;function l(h){return unescape(encodeURIComponent(h)).length}function d(h,E,m){const f=[];let w;for(;(w=h.exec(m))!==null;)f.push({data:w[0],index:w.index,mode:E,length:w[0].length});return f}function v(h){const E=d(a.NUMERIC,t.NUMERIC,h),m=d(a.ALPHANUMERIC,t.ALPHANUMERIC,h);let f,w;return c.isKanjiModeEnabled()?(f=d(a.BYTE,t.BYTE,h),w=d(a.KANJI,t.KANJI,h)):(f=d(a.BYTE_KANJI,t.BYTE,h),w=[]),E.concat(m,f,w).sort(function(C,M){return C.index-M.index}).map(function(C){return{data:C.data,mode:C.mode,length:C.length}})}function g(h,E){switch(E){case t.NUMERIC:return n.getBitsLength(h);case t.ALPHANUMERIC:return o.getBitsLength(h);case t.KANJI:return i.getBitsLength(h);case t.BYTE:return r.getBitsLength(h)}}function u(h){return h.reduce(function(E,m){const f=E.length-1>=0?E[E.length-1]:null;return f&&f.mode===m.mode?(E[E.length-1].data+=m.data,E):(E.push(m),E)},[])}function p(h){const E=[];for(let m=0;m<h.length;m++){const f=h[m];switch(f.mode){case t.NUMERIC:E.push([f,{data:f.data,mode:t.ALPHANUMERIC,length:f.length},{data:f.data,mode:t.BYTE,length:f.length}]);break;case t.ALPHANUMERIC:E.push([f,{data:f.data,mode:t.BYTE,length:f.length}]);break;case t.KANJI:E.push([f,{data:f.data,mode:t.BYTE,length:l(f.data)}]);break;case t.BYTE:E.push([{data:f.data,mode:t.BYTE,length:l(f.data)}])}}return E}function y(h,E){const m={},f={start:{}};let w=["start"];for(let b=0;b<h.length;b++){const C=h[b],M=[];for(let U=0;U<C.length;U++){const S=C[U],X=""+b+U;M.push(X),m[X]={node:S,lastCount:0},f[X]={};for(let ye=0;ye<w.length;ye++){const $=w[ye];m[$]&&m[$].node.mode===S.mode?(f[$][X]=g(m[$].lastCount+S.length,S.mode)-g(m[$].lastCount,S.mode),m[$].lastCount+=S.length):(m[$]&&(m[$].lastCount=S.length),f[$][X]=g(S.length,S.mode)+4+t.getCharCountIndicator(S.mode,E))}}w=M}for(let b=0;b<w.length;b++)f[w[b]].end=0;return{map:f,table:m}}function k(h,E){let m;const f=t.getBestModeForData(h);if(m=t.from(E,f),m!==t.BYTE&&m.bit<f.bit)throw new Error('"'+h+'" cannot be encoded with mode '+t.toString(m)+`.
 Suggested mode is: `+t.toString(f));switch(m===t.KANJI&&!c.isKanjiModeEnabled()&&(m=t.BYTE),m){case t.NUMERIC:return new n(h);case t.ALPHANUMERIC:return new o(h);case t.KANJI:return new i(h);case t.BYTE:return new r(h)}}e.fromArray=function(E){return E.reduce(function(m,f){return typeof f=="string"?m.push(k(f,null)):f.data&&m.push(k(f.data,f.mode)),m},[])},e.fromString=function(E,m){const f=v(E,c.isKanjiModeEnabled()),w=p(f),b=y(w,m),C=s.find_path(b.map,"start","end"),M=[];for(let U=1;U<C.length-1;U++)M.push(b.table[C[U]].node);return e.fromArray(u(M))},e.rawSplit=function(E){return e.fromArray(v(E,c.isKanjiModeEnabled()))}})(lt);const pe=P,ve=ge,Vt=bt,Ot=Bt,zt=et,jt=tt,Le=nt,Pe=me,xt=Ct,le=it,qt=st,Jt=_,we=lt;function Qt(e,t){const n=e.size,o=jt.getPositions(t);for(let r=0;r<o.length;r++){const i=o[r][0],a=o[r][1];for(let c=-1;c<=7;c++)if(!(i+c<=-1||n<=i+c))for(let s=-1;s<=7;s++)a+s<=-1||n<=a+s||(c>=0&&c<=6&&(s===0||s===6)||s>=0&&s<=6&&(c===0||c===6)||c>=2&&c<=4&&s>=2&&s<=4?e.set(i+c,a+s,!0,!0):e.set(i+c,a+s,!1,!0))}}function Yt(e){const t=e.size;for(let n=8;n<t-8;n++){const o=n%2===0;e.set(n,6,o,!0),e.set(6,n,o,!0)}}function Gt(e,t){const n=zt.getPositions(t);for(let o=0;o<n.length;o++){const r=n[o][0],i=n[o][1];for(let a=-2;a<=2;a++)for(let c=-2;c<=2;c++)a===-2||a===2||c===-2||c===2||a===0&&c===0?e.set(r+a,i+c,!0,!0):e.set(r+a,i+c,!1,!0)}}function Wt(e,t){const n=e.size,o=le.getEncodedBits(t);let r,i,a;for(let c=0;c<18;c++)r=Math.floor(c/3),i=c%3+n-8-3,a=(o>>c&1)===1,e.set(r,i,a,!0),e.set(i,r,a,!0)}function be(e,t,n){const o=e.size,r=qt.getEncodedBits(t,n);let i,a;for(i=0;i<15;i++)a=(r>>i&1)===1,i<6?e.set(i,8,a,!0):i<8?e.set(i+1,8,a,!0):e.set(o-15+i,8,a,!0),i<8?e.set(8,o-i-1,a,!0):i<9?e.set(8,15-i-1+1,a,!0):e.set(8,15-i-1,a,!0);e.set(o-8,8,1,!0)}function Zt(e,t){const n=e.size;let o=-1,r=n-1,i=7,a=0;for(let c=n-1;c>0;c-=2)for(c===6&&c--;;){for(let s=0;s<2;s++)if(!e.isReserved(r,c-s)){let l=!1;a<t.length&&(l=(t[a]>>>i&1)===1),e.set(r,c-s,l),i--,i===-1&&(a++,i=7)}if(r+=o,r<0||n<=r){r-=o,o=-o;break}}}function Xt(e,t,n){const o=new Vt;n.forEach(function(s){o.put(s.mode.bit,4),o.put(s.getLength(),Jt.getCharCountIndicator(s.mode,e)),s.write(o)});const r=pe.getSymbolTotalCodewords(e),i=Pe.getTotalCodewordsCount(e,t),a=(r-i)*8;for(o.getLengthInBits()+4<=a&&o.put(0,4);o.getLengthInBits()%8!==0;)o.putBit(0);const c=(a-o.getLengthInBits())/8;for(let s=0;s<c;s++)o.put(s%2?17:236,8);return en(o,e,t)}function en(e,t,n){const o=pe.getSymbolTotalCodewords(t),r=Pe.getTotalCodewordsCount(t,n),i=o-r,a=Pe.getBlocksCount(t,n),c=o%a,s=a-c,l=Math.floor(o/a),d=Math.floor(i/a),v=d+1,g=l-d,u=new xt(g);let p=0;const y=new Array(a),k=new Array(a);let h=0;const E=new Uint8Array(e.buffer);for(let C=0;C<a;C++){const M=C<s?d:v;y[C]=E.slice(p,p+M),k[C]=u.encode(y[C]),p+=M,h=Math.max(h,M)}const m=new Uint8Array(o);let f=0,w,b;for(w=0;w<h;w++)for(b=0;b<a;b++)w<y[b].length&&(m[f++]=y[b][w]);for(w=0;w<g;w++)for(b=0;b<a;b++)m[f++]=k[b][w];return m}function tn(e,t,n,o){let r;if(Array.isArray(e))r=we.fromArray(e);else if(typeof e=="string"){let l=t;if(!l){const d=we.rawSplit(e);l=le.getBestVersionForData(d,n)}r=we.fromString(e,l||40)}else throw new Error("Invalid data");const i=le.getBestVersionForData(r,n);if(!i)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=i;else if(t<i)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+i+`.
`);const a=Xt(t,n,r),c=pe.getSymbolSize(t),s=new Ot(c);return Qt(s,t),Yt(s),Gt(s,t),be(s,n,0),t>=7&&Wt(s,t),Zt(s,a),isNaN(o)&&(o=Le.getBestMask(s,be.bind(null,s,n))),Le.applyMask(o,s),be(s,n,o),{modules:s,version:t,errorCorrectionLevel:n,maskPattern:o,segments:r}}Ze.create=function(t,n){if(typeof t>"u"||t==="")throw new Error("No input text");let o=ve.M,r,i;return typeof n<"u"&&(o=ve.from(n.errorCorrectionLevel,ve.M),r=le.from(n.version),i=Le.from(n.maskPattern),n.toSJISFunc&&pe.setToSJISFunction(n.toSJISFunc)),tn(t,r,o,i)};var ut={},Ue={};(function(e){function t(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let o=n.slice().replace("#","").split("");if(o.length<3||o.length===5||o.length>8)throw new Error("Invalid hex color: "+n);(o.length===3||o.length===4)&&(o=Array.prototype.concat.apply([],o.map(function(i){return[i,i]}))),o.length===6&&o.push("F","F");const r=parseInt(o.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+o.slice(0,6).join("")}}e.getOptions=function(o){o||(o={}),o.color||(o.color={});const r=typeof o.margin>"u"||o.margin===null||o.margin<0?4:o.margin,i=o.width&&o.width>=21?o.width:void 0,a=o.scale||4;return{width:i,scale:i?4:a,margin:r,color:{dark:t(o.color.dark||"#000000ff"),light:t(o.color.light||"#ffffffff")},type:o.type,rendererOpts:o.rendererOpts||{}}},e.getScale=function(o,r){return r.width&&r.width>=o+r.margin*2?r.width/(o+r.margin*2):r.scale},e.getImageWidth=function(o,r){const i=e.getScale(o,r);return Math.floor((o+r.margin*2)*i)},e.qrToImageData=function(o,r,i){const a=r.modules.size,c=r.modules.data,s=e.getScale(a,i),l=Math.floor((a+i.margin*2)*s),d=i.margin*s,v=[i.color.light,i.color.dark];for(let g=0;g<l;g++)for(let u=0;u<l;u++){let p=(g*l+u)*4,y=i.color.light;if(g>=d&&u>=d&&g<l-d&&u<l-d){const k=Math.floor((g-d)/s),h=Math.floor((u-d)/s);y=v[c[k*a+h]?1:0]}o[p++]=y.r,o[p++]=y.g,o[p++]=y.b,o[p]=y.a}}})(Ue);(function(e){const t=Ue;function n(r,i,a){r.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=a,i.width=a,i.style.height=a+"px",i.style.width=a+"px"}function o(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}e.render=function(i,a,c){let s=c,l=a;typeof s>"u"&&(!a||!a.getContext)&&(s=a,a=void 0),a||(l=o()),s=t.getOptions(s);const d=t.getImageWidth(i.modules.size,s),v=l.getContext("2d"),g=v.createImageData(d,d);return t.qrToImageData(g.data,i,s),n(v,l,d),v.putImageData(g,0,0),l},e.renderToDataURL=function(i,a,c){let s=c;typeof s>"u"&&(!a||!a.getContext)&&(s=a,a=void 0),s||(s={});const l=e.render(i,a,s),d=s.type||"image/png",v=s.rendererOpts||{};return l.toDataURL(d,v.quality)}})(ut);var ft={};const nn=Ue;function Je(e,t){const n=e.a/255,o=t+'="'+e.hex+'"';return n<1?o+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':o}function Be(e,t,n){let o=e+t;return typeof n<"u"&&(o+=" "+n),o}function on(e,t,n){let o="",r=0,i=!1,a=0;for(let c=0;c<e.length;c++){const s=Math.floor(c%t),l=Math.floor(c/t);!s&&!i&&(i=!0),e[c]?(a++,c>0&&s>0&&e[c-1]||(o+=i?Be("M",s+n,.5+l+n):Be("m",r,0),r=0,i=!1),s+1<t&&e[c+1]||(o+=Be("h",a),a=0)):r++}return o}ft.render=function(t,n,o){const r=nn.getOptions(n),i=t.modules.size,a=t.modules.data,c=i+r.margin*2,s=r.color.light.a?"<path "+Je(r.color.light,"fill")+' d="M0 0h'+c+"v"+c+'H0z"/>':"",l="<path "+Je(r.color.dark,"stroke")+' d="'+on(a,i,r.margin)+'"/>',d='viewBox="0 0 '+c+" "+c+'"',g='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+d+' shape-rendering="crispEdges">'+s+l+`</svg>
`;return typeof o=="function"&&o(null,g),g};const rn=vt,Ae=Ze,gt=ut,an=ft;function Fe(e,t,n,o,r){const i=[].slice.call(arguments,1),a=i.length,c=typeof i[a-1]=="function";if(!c&&!rn())throw new Error("Callback required as last argument");if(c){if(a<2)throw new Error("Too few arguments provided");a===2?(r=n,n=t,t=o=void 0):a===3&&(t.getContext&&typeof r>"u"?(r=o,o=void 0):(r=o,o=n,n=t,t=void 0))}else{if(a<1)throw new Error("Too few arguments provided");return a===1?(n=t,t=o=void 0):a===2&&!t.getContext&&(o=n,n=t,t=void 0),new Promise(function(s,l){try{const d=Ae.create(n,o);s(e(d,t,o))}catch(d){l(d)}})}try{const s=Ae.create(n,o);r(null,e(s,t,o))}catch(s){r(s)}}G.create=Ae.create;G.toCanvas=Fe.bind(null,gt.render);G.toDataURL=Fe.bind(null,gt.renderToDataURL);G.toString=Fe.bind(null,function(e,t,n){return an.render(e,n)});let I=null,B=new Map,N=[],T=null;const O=document.getElementById("preference-category"),Me=document.getElementById("preference-search"),Qe=document.getElementById("clear-preferences"),se=document.getElementById("preferences-list"),Ye=document.getElementById("selected-preferences"),Ge=document.getElementById("selected-list"),sn=document.getElementById("preference-count"),Se=document.querySelectorAll(".template-btn"),H=document.getElementById("preferences-qr"),de=document.getElementById("preferences-download"),ue=document.getElementById("preferences-copy"),fe=document.getElementById("preferences-package"),D=document.getElementById("atak-version"),Re=document.getElementById("hide-disable-toggle"),cn=document.getElementById("hide-disable-container");async function ln(){console.log("Initializing preferences..."),await un(),await fn(),mn(),hn(),I&&I.preferenceKeys?(N=Object.entries(I.preferenceKeys),console.log(`Initialized ${N.length} preferences`),console.log("Sample preferences:",N.slice(0,3))):(console.error("No preference data available"),console.error("preferenceData structure:",I),N=[]),V(),console.log("Preferences initialization complete")}function dn(){console.log("Refreshing preferences display..."),V()}async function un(){try{console.log("Loading preference data...");const e=await fetch("/docs/reference/ATAK-Preference-Keys-Data.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);I=await e.json(),console.log("Loaded preference data:",I.metadata),console.log(`Total preference keys: ${Object.keys(I.preferenceKeys).length}`)}catch(e){console.error("Failed to load preference data:",e),I={metadata:{totalKeys:0},preferenceKeys:{locationCallsign:{name:"My Callsign",type:"string",category:"identity",description:"User's callsign identifier",defaultValue:"",allowedValues:["alphanumeric"]},locationTeam:{name:"My Team",type:"string",category:"identity",description:"Team color affiliation",defaultValue:"White",allowedValues:["White","Yellow","Orange","Magenta","Red","Maroon","Purple","Dark Blue","Blue","Cyan","Teal","Green","Dark Green","Brown"]},atakRoleType:{name:"My Role",type:"string",category:"identity",description:"User's operational role",defaultValue:"Team Member",allowedValues:["Team Member","Team Lead","HQ","Sniper","Medic","Forward Observer","RTO","K9"]}}},console.log("Using fallback preference data")}}async function fn(){try{const e=[{version:"5.4.0",file:"5.4.0-prefs.txt"},{version:"5.2.0.0",file:"5.2.0.0-prefs.txt"},{version:"5.0",file:"5.0-preferences.txt"},{version:"4.8.1",file:"4.8.1-preferences.txt"}];T={};for(const{version:o,file:r}of e)try{const a=await(await fetch(`/docs/versions/${r}`)).text();T[o]=gn(a),console.log(`Loaded version ${o} data:`,{hideCount:T[o].hide.size,disableCount:T[o].disable.size,sampleKeys:Array.from(T[o].hide.keys()).slice(0,5)})}catch(i){console.warn(`Failed to load version ${o} data:`,i)}console.log("Loaded version data:",Object.keys(T));const t="locationCallsign";for(const[o,r]of Object.entries(T)){const i=r.hide.has(t)||r.disable.has(t);console.log(`Version ${o} has ${t}:`,i),i&&console.log(`  Name: ${r.hide.get(t)||r.disable.get(t)}`)}console.log("Testing version filtering logic...");const n=Object.keys(I.preferenceKeys).slice(0,5);for(const o of Object.keys(T)){console.log(`
Version ${o}:`);for(const r of n){const i=T[o],a=i.hide.has(r),c=i.disable.has(r);console.log(`  ${r}: hide=${a}, disable=${c}`)}}}catch(e){console.error("Failed to load version data:",e),T={}}}function gn(e){const t={hide:new Map,disable:new Map},n=e.split(`
`);for(const o of n){const r=o.match(/'([^']+)',\s*'([^']+)'/);if(r){const[,i,a]=r,c=/^[a-zA-Z][a-zA-Z0-9_]*$/.test(i)&&!i.includes(" "),s=/^[a-zA-Z][a-zA-Z0-9_]*$/.test(a)&&!a.includes(" ");let l,d;c&&!s?(l=i,d=a):!c&&s?(l=a,d=i):(l=i,d=a),t.hide.set(l,d),t.disable.set(l,d)}}return t}function mn(){console.log("Setting up event listeners..."),O?(O.addEventListener("change",Ie),console.log("Category select listener added")):console.warn("Category select element not found"),Me?(Me.addEventListener("input",Ie),console.log("Search input listener added")):console.warn("Search input element not found"),Qe?(Qe.addEventListener("click",In),console.log("Clear button listener added")):console.warn("Clear button element not found"),Se.forEach(e=>{e.addEventListener("click",()=>Cn(e.dataset.template))}),console.log(`Template button listeners added: ${Se.length}`),de&&(de.addEventListener("click",()=>kn()),console.log("Download button listener added")),ue&&(ue.addEventListener("click",()=>Tn()),console.log("Copy button listener added")),fe&&(fe.addEventListener("click",Ln),console.log("Package button listener added")),D?(D.addEventListener("change",Ie),console.log("Version select listener added")):console.warn("Version select element not found"),Re?(Re.addEventListener("change",pn),console.log("Hide/disable toggle listener added")):console.warn("Hide/disable toggle element not found"),console.log("Event listeners setup complete")}function hn(){if(!D)return;const e=Object.keys(T).sort((t,n)=>{const o=t.split(".").map(Number),r=n.split(".").map(Number);for(let i=0;i<Math.max(o.length,r.length);i++){const a=o[i]||0,c=r[i]||0;if(a!==c)return c-a}return 0});D.innerHTML='<option value="">All Versions</option>',e.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=`ATAK ${t}`,D.appendChild(n)}),O&&I&&I.metadata&&I.metadata.categories?(O.innerHTML='<option value="">All Categories</option>',I.metadata.categories.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t.charAt(0).toUpperCase()+t.slice(1),O.appendChild(n)}),console.log(`Populated category select with ${I.metadata.categories.length} categories`)):console.warn("Could not populate category select - missing data")}function pn(){const e=Re.checked,t=cn;e?(t.style.display="block",t.innerHTML=`
            <div class="hide-disable-controls">
                <div class="control-group">
                    <label>Action Type:</label>
                    <select id="action-type" class="form-select">
                        <option value="hide">Hide Preferences</option>
                        <option value="disable">Disable Preferences</option>
                        <option value="both">Both Hide & Disable</option>
                    </select>
                </div>
                <div class="control-group">
                    <button id="apply-hide-disable" class="btn btn-warning">Apply to Selected</button>
                </div>
            </div>
            <div class="hide-disable-info">
                <p><strong>Hide:</strong> Preferences are completely hidden from the user interface</p>
                <p><strong>Disable:</strong> Preferences are visible but grayed out and non-interactive</p>
            </div>
        `,setTimeout(()=>{const n=document.getElementById("apply-hide-disable");n&&n.addEventListener("click",yn)},100)):t.style.display="none"}function yn(){const e=document.getElementById("action-type").value,t=Array.from(B.keys());if(t.length===0){oe("No preferences selected","warning");return}t.forEach(n=>{I.preferenceKeys[n]&&((e==="hide"||e==="both")&&B.set(`hidePreferenceItem_${n}`,!0),(e==="disable"||e==="both")&&B.set(`disablePreferenceItem_${n}`,!0))}),W(),Z(),oe(`Applied ${e} to ${t.length} preferences`,"success")}function Ie(){const e=O.value,t=Me.value.toLowerCase(),n=D?D.value:"";N=Object.entries(I.preferenceKeys).filter(([o,r])=>{const i=!e||r.category===e,a=!t||o.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||r.description.toLowerCase().includes(t);let c=!0;if(n&&T[n]){const s=T[n],l=s.hide.has(o),d=s.disable.has(o);c=l||d,n&&console.log(`Version ${n} - ${o}: hide=${l}, disable=${d}, matches=${c}`)}return i&&a&&c}).sort(([,o],[,r])=>o.name.localeCompare(r.name)),V()}function V(){if(console.log("Rendering preferences...",N.length),!se){console.error("Preferences list element not found");return}if(se.innerHTML="",N.length===0){se.innerHTML='<div class="no-results">No preferences found matching your criteria.</div>',console.log("No preferences to render");return}const e=D?D.value:"";console.log(`Rendering ${N.length} preferences for version: ${e||"all"}`),N.forEach(([t,n])=>{const o=En(t,n,e);se.appendChild(o)}),console.log("Preferences rendering complete")}function En(e,t,n){const o=document.createElement("div");o.className="preference-item",B.has(e)&&o.classList.add("selected");const i=B.has(e)?B.get(e):t.defaultValue;let a="";if(n&&T[n]){const s=T[n],l=s.hide.has(e),d=s.disable.has(e);(l||d)&&(a=`
                <div class="version-info">
                    <span class="version-badge">ATAK ${n}</span>
                    ${l?'<span class="hide-badge">Hide</span>':""}
                    ${d?'<span class="disable-badge">Disable</span>':""}
                </div>
            `)}o.innerHTML=`
        <div class="preference-header">
            <div class="preference-name">${t.name}</div>
            <div class="preference-category">${t.category}</div>
            ${a}
        </div>
        <div class="preference-description">${t.description}</div>
        <div class="preference-control">
            <label>Value:</label>
            ${vn(e,t,i)}
        </div>
        <div class="preference-validation" id="validation-${e}"></div>
    `,o.addEventListener("click",s=>{s.target.matches("input, select")||wn(e,t)});const c=o.querySelector("input, select");return c&&(c.addEventListener("change",s=>{bn(e,s.target.value)}),c.addEventListener("input",s=>{Bn(e,t,s.target.value)})),o}function vn(e,t,n){switch(t.type){case"boolean":return`
                <select>
                    <option value="true" ${n===!0||n==="true"?"selected":""}>true</option>
                    <option value="false" ${n===!1||n==="false"?"selected":""}>false</option>
                </select>
            `;case"string":return t.allowedValues&&Array.isArray(t.allowedValues)?`
                    <select>
                        ${t.allowedValues.map(o=>`<option value="${o}" ${n===o?"selected":""}>${o}</option>`).join("")}
                    </select>
                `:`<input type="text" value="${n||""}" placeholder="Enter value">`;case"int":case"long":return`<input type="number" value="${n||""}" placeholder="Enter number">`;default:return`<input type="text" value="${n||""}" placeholder="Enter value">`}}function wn(e,t){B.has(e)?B.delete(e):B.set(e,t.defaultValue),V(),W(),Z()}function bn(e,t){B.has(e)&&(B.set(e,t),W(),Z())}function Bn(e,t,n){const o=document.getElementById(`validation-${e}`);if(!o)return;let r=!0,i="";switch(t.type){case"boolean":r=n==="true"||n==="false";break;case"int":case"long":r=!isNaN(n)&&Number.isInteger(Number(n)),r&&t.validation&&(t.validation.minValue!==void 0&&Number(n)<t.validation.minValue&&(r=!1,i=`Minimum value: ${t.validation.minValue}`),t.validation.maxValue!==void 0&&Number(n)>t.validation.maxValue&&(r=!1,i=`Maximum value: ${t.validation.maxValue}`));break;case"string":t.validation&&(t.validation.minLength!==void 0&&n.length<t.validation.minLength&&(r=!1,i=`Minimum length: ${t.validation.minLength}`),t.validation.maxLength!==void 0&&n.length>t.validation.maxLength&&(r=!1,i=`Maximum length: ${t.validation.maxLength}`),t.validation.pattern&&!new RegExp(t.validation.pattern).test(n)&&(r=!1,i="Invalid format"));break}o.className=`preference-validation ${r?"":"error"}`,o.textContent=i}function W(){if(B.size===0){Ye.style.display="none";return}Ye.style.display="block",sn.textContent=B.size,Ge.innerHTML="",B.forEach((e,t)=>{const n=I.preferenceKeys[t];if(!n)return;const o=document.createElement("div");o.className="selected-item",o.innerHTML=`
            <div class="selected-item-info">
                <div class="selected-item-name">${n.name}</div>
                <div class="selected-item-value">${t} = ${e}</div>
            </div>
            <button class="selected-item-remove" onclick="removePreference('${t}')">Remove</button>
        `,Ge.appendChild(o)})}window.removePreference=function(e){B.delete(e),V(),W(),Z()};function In(){B.clear(),V(),W(),Z()}function Cn(e){B.clear();const n={fire:{locationTeam:"Red",atakRoleType:"Team Lead",coord_display_pref:"UTM",largeTextMode:!0,dispatchLocationCotExternal:!0},police:{locationTeam:"Blue",atakRoleType:"Team Member",mockingOption:"WRGPS",locationReportingStrategy:"Dynamic",dispatchLocationCotExternal:!0},ems:{locationTeam:"Green",atakRoleType:"Medic",saHasPhoneNumber:!0,enableToast:!0,vibratePhone:!0,audibleNotify:!0},military:{locationTeam:"Dark Green",atakRoleType:"Team Lead",coord_display_pref:"MGRS",alt_display_pref:"HAE",useGPSTime:!0,dispatchLocationCotExternal:!0},sar:{locationTeam:"Orange",atakRoleType:"Team Member",coord_display_pref:"UTM",alt_unit_pref:"1",enableNonStreamingConnections:!0,dispatchLocationCotExternal:!0}}[e];n&&Object.entries(n).forEach(([o,r])=>{I.preferenceKeys[o]&&B.set(o,r)}),Se.forEach(o=>o.classList.remove("active")),event.target.classList.add("active"),V(),W(),Z()}async function Z(){if(B.size===0){H.innerHTML='<div class="qr-placeholder">Select preferences above to generate QR code</div>',de.disabled=!0,ue.disabled=!0,fe.disabled=!0;return}const e=[];let t=1;B.forEach((o,r)=>{const i=I.preferenceKeys[r];i&&(e.push(`key${t}=${encodeURIComponent(r)}`),e.push(`type${t}=${encodeURIComponent(i.type)}`),e.push(`value${t}=${encodeURIComponent(o)}`),t++)});const n=`tak://com.atakmap.app/preference?${e.join("&")}`;try{const o=await G.toCanvas(n,{width:256,margin:2,color:{dark:"#1e40af",light:"#ffffff"}});H.innerHTML="",H.appendChild(o),de.disabled=!1,ue.disabled=!1,fe.disabled=!1,H.dataset.url=n}catch(o){console.error("Failed to generate QR code:",o),H.innerHTML='<div class="qr-placeholder">Error generating QR code</div>'}}async function kn(e){const t=H.querySelector("canvas");if(!t)return;const n=document.createElement("a");n.download="atak-preferences.png",n.href=t.toDataURL(),n.click()}function Tn(e){const t=H.dataset.url;t&&navigator.clipboard.writeText(t).then(()=>{oe("Preference URI copied to clipboard","success")}).catch(()=>{oe("Failed to copy URI","error")})}function Ln(){if(B.size===0)return;const e=Pn(),t=new Blob([e],{type:"application/xml"}),n=document.createElement("a");n.download="atak-config.pref",n.href=URL.createObjectURL(t),n.click(),oe("Data package config.pref downloaded","success")}function Pn(){const e=[];return B.forEach((t,n)=>{const o=I.preferenceKeys[n];if(o){const r=An(o.type);e.push(`    <entry key="${n}" class="${r}">${t}</entry>`)}}),`<?xml version='1.0' encoding='ASCII' standalone='yes'?>
<preferences>
  <preference version="1" name="com.atakmap.app_preferences">
${e.join(`
`)}
  </preference>
</preferences>`}function An(e){switch(e){case"boolean":return"class java.lang.Boolean";case"int":return"class java.lang.Integer";case"long":return"class java.lang.Long";case"string":default:return"class java.lang.String"}}function oe(e,t="info"){console.log(`${t.toUpperCase()}: ${e}`)}let te="atak",A=JSON.parse(localStorage.getItem("tak-profiles")||"[]");const mt=document.querySelectorAll(".tab-btn"),Mn=document.querySelectorAll(".tab-pane"),z=document.getElementById("profile-modal"),Sn=document.querySelector(".modal-close"),Rn=document.getElementById("modal-cancel"),$n=document.getElementById("modal-save"),_e=document.getElementById("profile-name"),He=document.getElementById("profile-description");document.addEventListener("DOMContentLoaded",async()=>{Nn(),Fn(),_n(),zn(),je(),await ln(),Jn(),qn(),xn()});function Nn(){mt.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;j(t)})})}function j(e){mt.forEach(t=>t.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),Mn.forEach(t=>t.classList.remove("active")),document.getElementById(`${e}-tab`).classList.add("active"),te==="atak"&&e==="itak"?Dn():te==="itak"&&e==="atak"&&Un(),e==="preferences"&&dn(),te=e}function Dn(){const e=document.getElementById("atak-host").value.trim();if(e){const t=document.getElementById("itak-url");t.value.trim()||(t.value=`https://${e}`,Ve(),Et("itak"),L("Server URL copied from ATAK tab","info"))}}function Un(){const e=document.getElementById("itak-url").value.trim();if(e){let t="";try{const n=e.startsWith("http")?e:`https://${e}`;t=new URL(n).hostname}catch{t=e.replace(/^https?:\/\//,"").split("/")[0].split(":")[0]}if(t){const n=document.getElementById("atak-host");n.value.trim()||(n.value=t,Ke(),Et("atak"),L("Server hostname copied from iTAK tab","info"))}}}function Fn(){document.getElementById("atak-form").querySelectorAll("input").forEach(a=>{a.addEventListener("input",()=>Ke())}),document.getElementById("itak-form").querySelectorAll("input, select").forEach(a=>{a.addEventListener("input",()=>Ve())}),document.getElementById("import-form").querySelectorAll("input").forEach(a=>{a.addEventListener("input",()=>ht())}),document.getElementById("atak-download").addEventListener("click",()=>Ce("atak")),document.getElementById("atak-copy").addEventListener("click",()=>ke("atak")),document.getElementById("itak-download").addEventListener("click",()=>Ce("itak")),document.getElementById("itak-copy").addEventListener("click",()=>ke("itak")),document.getElementById("import-download").addEventListener("click",()=>Ce("import")),document.getElementById("import-copy").addEventListener("click",()=>ke("import"))}async function Y(e,t){const n=document.getElementById(t);if(!e)return n.innerHTML='<div class="qr-placeholder">Enter configuration details above</div>',null;try{const o=await G.toCanvas(e,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});return n.innerHTML="",n.appendChild(o),o}catch(o){return console.error("Error generating QR code:",o),n.innerHTML='<div class="qr-placeholder">Error generating QR code</div>',null}}function Ke(){const e=document.getElementById("atak-host").value.trim(),t=document.getElementById("atak-username").value.trim(),n=document.getElementById("atak-token").value.trim();if(e&&t&&n){const o=`tak://com.atakmap.app/enroll?host=${encodeURIComponent(e)}&username=${encodeURIComponent(t)}&token=${encodeURIComponent(n)}`;Y(o,"atak-qr"),Oe("atak")}else Y(null,"atak-qr"),ze("atak")}function Ve(){const e=document.getElementById("itak-description").value.trim(),t=document.getElementById("itak-url").value.trim(),n=document.getElementById("itak-port").value.trim(),o=document.getElementById("itak-protocol").value;let r="";try{if(t){const s=t.startsWith("http")?t:`https://${t}`;r=new URL(s).hostname}}catch{r=t.replace(/^https?:\/\//,"").split("/")[0].split(":")[0]}const i=o==="https"?"ssl":"tcp";if([e,r,n].every(s=>s&&s.trim()!=="")){const s=`${e},${r},${n},${i}`;Y(s,"itak-qr"),Oe("itak")}else Y(null,"itak-qr"),ze("itak")}function ht(){const e=document.getElementById("import-url").value.trim();if(e){const t=`tak://com.atakmap.app/import?url=${encodeURIComponent(e)}`;Y(t,"import-qr"),Oe("import")}else Y(null,"import-qr"),ze("import")}function Oe(e){document.getElementById(`${e}-download`).disabled=!1,document.getElementById(`${e}-copy`).disabled=!1}function ze(e){document.getElementById(`${e}-download`).disabled=!0,document.getElementById(`${e}-copy`).disabled=!0}async function Ce(e){const n=document.getElementById(`${e}-qr`).querySelector("canvas");if(n)try{const o=document.createElement("a");o.download=`tak-${e}-config.png`,o.href=n.toDataURL(),o.click()}catch(o){console.error("Error downloading QR code:",o),L("Error downloading QR code","error")}}async function ke(e){let t="";switch(e){case"atak":const n=document.getElementById("atak-host").value.trim(),o=document.getElementById("atak-username").value.trim(),r=document.getElementById("atak-token").value.trim();t=`tak://com.atakmap.app/enroll?host=${encodeURIComponent(n)}&username=${encodeURIComponent(o)}&token=${encodeURIComponent(r)}`;break;case"itak":const i=document.getElementById("itak-description").value.trim(),a=document.getElementById("itak-url").value.trim(),c=document.getElementById("itak-port").value.trim(),s=document.getElementById("itak-protocol").value;let l="";try{if(a){const g=a.startsWith("http")?a:`https://${a}`;l=new URL(g).hostname}}catch{l=a.replace(/^https?:\/\//,"").split("/")[0].split(":")[0]}t=`${i},${l},${c},${s==="https"?"ssl":"tcp"}`;break;case"import":const v=document.getElementById("import-url").value.trim();t=`tak://com.atakmap.app/import?url=${encodeURIComponent(v)}`;break}try{await navigator.clipboard.writeText(t),L("URI copied to clipboard!","success")}catch(n){console.error("Error copying to clipboard:",n),L("Error copying to clipboard","error")}}function _n(){document.getElementById("save-profile").addEventListener("click",()=>{Hn()}),document.getElementById("load-profile").addEventListener("click",()=>{Kn()})}function Hn(){document.getElementById("modal-title").textContent="Save Profile",z.classList.add("active");const e=pt();e.name&&(_e.value=e.name,He.value=e.description||"")}function Kn(){document.getElementById("modal-title").textContent="Load Profile",z.classList.add("active"),jn()}function pt(){const e={type:te,timestamp:Date.now()};switch(te){case"atak":e.host=document.getElementById("atak-host").value,e.username=document.getElementById("atak-username").value,e.token=document.getElementById("atak-token").value;break;case"itak":e.description=document.getElementById("itak-description").value,e.url=document.getElementById("itak-url").value,e.port=document.getElementById("itak-port").value,e.protocol=document.getElementById("itak-protocol").value;break;case"import":e.url=document.getElementById("import-url").value;break}return e}function Vn(){const e=_e.value.trim(),t=He.value.trim();if(!e){L("Profile name is required","error");return}const n=pt();n.name=e,n.description=t;const o=A.findIndex(r=>r.name===e);o>=0?A[o]=n:A.push(n),localStorage.setItem("tak-profiles",JSON.stringify(A)),je(),K(),L("Profile saved successfully!","success")}function yt(e){switch(e.type){case"atak":document.getElementById("atak-host").value=e.host||"",document.getElementById("atak-username").value=e.username||"",document.getElementById("atak-token").value=e.token||"",Ke(),j("atak");break;case"itak":document.getElementById("itak-description").value=e.description||"",document.getElementById("itak-url").value=e.url||"",document.getElementById("itak-port").value=e.port||"8089",document.getElementById("itak-protocol").value=e.protocol||"https",Ve(),j("itak");break;case"import":document.getElementById("import-url").value=e.url||"",ht(),j("import");break}K(),L("Profile loaded successfully!","success")}function On(e){confirm(`Are you sure you want to delete the profile "${e}"?`)&&(A=A.filter(t=>t.name!==e),localStorage.setItem("tak-profiles",JSON.stringify(A)),je(),L("Profile deleted successfully!","success"))}function je(){const e=document.getElementById("profiles-container");if(A.length===0){e.innerHTML='<p style="grid-column: 1 / -1; color: var(--text-secondary);">No saved profiles yet. Create your first profile to get started.</p>';return}e.innerHTML=A.map(t=>`
        <div class="profile-card">
            <h4>${t.name}</h4>
            <p>${t.description||"No description"}</p>
            <p><strong>Type:</strong> ${t.type.toUpperCase()}</p>
            <p><strong>Created:</strong> ${new Date(t.timestamp).toLocaleDateString()}</p>
            <div class="profile-actions">
                <button class="btn btn-primary" onclick="loadProfile(${JSON.stringify(t).replace(/"/g,"&quot;")})">Load</button>
                <button class="btn btn-secondary" onclick="deleteProfile('${t.name}')">Delete</button>
            </div>
        </div>
    `).join("")}function zn(){Sn.addEventListener("click",K),Rn.addEventListener("click",K),$n.addEventListener("click",Vn),z.addEventListener("click",e=>{e.target===z&&K()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&z.classList.contains("active")&&K()})}function K(){z.classList.remove("active"),_e.value="",He.value=""}function jn(){if(A.length===0){alert("No saved profiles found."),K();return}const e=A.map(n=>`${n.name} (${n.type.toUpperCase()})`).join(`
`),t=prompt(`Select a profile to load:

${e}

Enter the profile name:`);if(t){const n=A.find(o=>o.name===t);n?yt(n):L("Profile not found","error")}}function L(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.innerHTML=`
        <div class="notification-content">
            <span class="notification-message">${e}</span>
            <button class="notification-close">&times;</button>
        </div>
    `,document.body.appendChild(n),setTimeout(()=>{n.classList.add("show")},100),setTimeout(()=>{We(n)},5e3),n.querySelector(".notification-close").addEventListener("click",()=>{We(n)})}function We(e){e.classList.remove("show"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}function xn(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})})}window.loadProfile=yt;window.deleteProfile=On;window.showNotification=L;function qn(){const e=document.getElementById("help-button"),t=document.getElementById("back-to-top");e&&e.addEventListener("click",()=>{j("help")}),t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),document.addEventListener("keydown",n=>{n.key==="F1"&&(n.preventDefault(),j("help"))})}function Et(e){const t=document.getElementById(`${e}-data-status`);t&&(t.style.display="flex",setTimeout(()=>{t.style.display="none"},5e3))}function Jn(){Qn(),Yn()}async function Qn(){try{const t=await(await fetch("/docs/matrix/version-matrix-web.json")).json(),n=document.getElementById("matrix-stats");if(!n)return;const o=t.preferences.length,r=t.versions.length;let i=0,a=0,c=0;t.preferences.forEach(s=>{let l=!1,d=!1;Object.values(s.versions).forEach(v=>{v.hide&&(l=!0),v.disable&&(d=!0)}),l&&d?c++:l?i++:d&&a++}),n.innerHTML=`
            <div class="matrix-stat">
                <div class="matrix-stat-number">${o}</div>
                <div class="matrix-stat-label">Total Preferences</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${r}</div>
                <div class="matrix-stat-label">ATAK Versions</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${i+c}</div>
                <div class="matrix-stat-label">Can Hide</div>
            </div>
            <div class="matrix-stat">
                <div class="matrix-stat-number">${a+c}</div>
                <div class="matrix-stat-label">Can Disable</div>
            </div>
        `}catch(e){console.error("Error loading matrix stats:",e);const t=document.getElementById("matrix-stats");t&&(t.innerHTML='<div class="error">Error loading matrix data</div>')}}function Yn(){const e=document.getElementById("download-matrix");e&&e.addEventListener("click",Gn)}async function Gn(){try{const t=await(await fetch("/docs/matrix/version-matrix.json")).json(),n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="atak-version-matrix.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),L("Matrix data downloaded successfully","success")}catch(e){console.error("Error downloading matrix data:",e),L("Error downloading matrix data","error")}}
